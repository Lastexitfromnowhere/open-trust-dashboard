<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPEN-TRUST â€” Verify. Without Trust.</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:         #060606;
  --surface:    rgba(255,255,255,0.02);
  --surface2:   rgba(255,255,255,0.04);
  --border:     rgba(255,255,255,0.06);
  --border-hi:  rgba(74,222,128,0.30);

  --accent:     #4ade80;
  --accent-dim: rgba(74,222,128,0.08);
  --accent-glow:rgba(74,222,128,0.20);
  --green:      #4ade80;
  --green-dim:  rgba(74,222,128,0.08);
  --red:        #f87171;
  --red-dim:    rgba(248,113,113,0.10);
  --amber:      #facc15;
  --amber-dim:  rgba(250,204,21,0.10);
  --purple:     #c084fc;
  --purple-dim: rgba(192,132,252,0.10);

  --text:       rgba(255,255,255,0.88);
  --text-muted: rgba(255,255,255,0.32);
  --text-dim:   rgba(255,255,255,0.55);
  --mono:       'Share Tech Mono', monospace;
  --title:      'Orbitron', sans-serif;

  --radius:     3px;
  --radius-sm:  2px;
}

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--mono);
  font-size: 14px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px);
  pointer-events: none;
  z-index: 0;
}

body::after {
  content: '';
  position: fixed;
  top: -200px; left: 50%; transform: translateX(-50%);
  width: 600px; height: 400px;
  background: radial-gradient(ellipse at center, rgba(74,222,128,0.04) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

.wrapper {
  position: relative; z-index: 1;
  max-width: 860px;
  margin: 0 auto;
  padding: 0 24px 80px;
}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 32px 0 28px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 0;
}

.logo { display: flex; align-items: center; gap: 16px; }

.logo-icon {
  width: 52px; height: 52px;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(74,222,128,0.10) 0%, rgba(74,222,128,0.03) 100%);
  border: 1px solid rgba(74,222,128,0.35);
  display: grid; place-items: center;
  position: relative;
  animation: glow-pulse 3s ease-in-out infinite;
  flex-shrink: 0;
}
.logo-icon::before {
  content: '';
  position: absolute; inset: -1px;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(74,222,128,0.4), transparent 60%);
  mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  mask-composite: exclude;
  padding: 1px;
  pointer-events: none;
}

.logo-text {
  display: flex; flex-direction: column; gap: 2px;
}
.logo-team {
  font-family: var(--mono);
  font-size: 9px; font-weight: 400;
  letter-spacing: 0.20em; color: var(--text-muted);
  text-transform: uppercase;
}
.logo-name {
  font-family: var(--title);
  font-size: 13px; font-weight: 900;
  letter-spacing: 0.18em; color: #ffffff;
  line-height: 1;
}
.logo-name .logo-accent { color: var(--accent); }
.logo-product {
  font-family: var(--mono);
  font-size: 10px; font-weight: 400;
  letter-spacing: 0.14em; color: var(--accent);
  text-transform: uppercase;
  display: flex; align-items: center; gap: 6px;
}
.logo-product::before {
  content: '';
  display: inline-block; width: 18px; height: 1px;
  background: var(--accent); opacity: 0.5;
}

.header-badge {
  font-size: 10px; color: var(--text-muted);
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 5px 12px; letter-spacing: 0.06em;
}

/* â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  margin-bottom: 40px;
}

.tab-btn {
  font-family: var(--title);
  font-size: 11px; letter-spacing: 0.14em;
  color: var(--text-muted);
  background: none; border: none;
  border-bottom: 2px solid transparent;
  padding: 14px 28px;
  cursor: pointer;
  transition: all 0.15s;
  margin-bottom: -1px;
}
.tab-btn:hover { color: var(--text-dim); }
.tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

/* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero {
  text-align: center;
  margin-bottom: 48px;
}
.hero h1 {
  font-family: var(--title);
  font-size: clamp(22px, 4.5vw, 34px); font-weight: 900;
  letter-spacing: 0.04em; color: #ffffff;
  margin-bottom: 14px;
  text-shadow: 0 0 40px rgba(74,222,128,0.15);
}
.hero p {
  color: var(--text-dim); font-size: 13px;
  max-width: 480px; margin: 0 auto 20px;
}

.zero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  background: var(--accent-dim);
  border: 1px solid rgba(74,222,128,0.20);
  border-radius: var(--radius);
  padding: 6px 16px; font-size: 11px;
  color: var(--accent); letter-spacing: 0.04em;
}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px; margin-bottom: 16px;
  transition: border-color 0.2s;
}
.card:hover { border-color: rgba(74,222,128,0.15); }

.card-title {
  font-size: 10px; text-transform: uppercase;
  letter-spacing: 0.14em; color: var(--text-muted);
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px;
}
.card-title .step-num {
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--accent-dim); border: 1px solid var(--border-hi);
  display: grid; place-items: center;
  font-size: 10px; color: var(--accent);
}

/* â”€â”€ Drop zone (verify) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.drop-zone {
  border: 1px dashed rgba(255,255,255,0.10);
  border-radius: var(--radius); padding: 44px 24px;
  text-align: center; cursor: pointer;
  transition: all 0.25s; position: relative;
  background: var(--surface2);
}
.drop-zone:hover, .drop-zone.drag-over {
  border-color: var(--accent);
  background: rgba(74,222,128,0.03);
  box-shadow: 0 0 40px rgba(74,222,128,0.05), inset 0 0 30px rgba(74,222,128,0.02);
}
.drop-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.drop-zone .drop-icon { font-size: 30px; margin-bottom: 12px; display: block; opacity: 0.5; }
.drop-zone .drop-title { font-size: 13px; color: var(--text); margin-bottom: 6px; letter-spacing: 0.04em; }
.drop-zone .drop-hint { font-size: 11px; color: var(--text-muted); }
.drop-zone .drop-hint code {
  font-family: var(--mono);
  background: rgba(74,222,128,0.08); color: var(--accent);
  padding: 1px 6px; border-radius: var(--radius-sm); font-size: 11px;
}

/* â”€â”€ File pills â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.files-list { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
.file-pill {
  display: flex; align-items: center; gap: 6px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 5px 10px;
  font-size: 11px; font-family: var(--mono);
  color: var(--text-dim); animation: fadein 0.2s ease;
}
.file-pill.type-binary    { border-color: rgba(192,132,252,0.25); color: var(--purple); }
.file-pill.type-provenance{ border-color: rgba(74,222,128,0.25);  color: var(--accent); }
.file-pill .dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }

/* â”€â”€ Registry input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.registry-row { display: flex; gap: 10px; align-items: center; }
.input-wrap { flex: 1; position: relative; }
.input-wrap label {
  display: block; font-size: 10px; color: var(--text-muted);
  margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.10em;
}
.input-wrap input {
  width: 100%; background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text);
  font-family: var(--mono); font-size: 12px; padding: 10px 14px;
  transition: border-color 0.2s; outline: none;
}
.input-wrap input:focus { border-color: rgba(74,222,128,0.50); box-shadow: 0 0 0 3px rgba(74,222,128,0.06); }
.input-wrap input::placeholder { color: var(--text-muted); opacity: 0.5; }

/* â”€â”€ Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toggle-wrap {
  display: flex; align-items: center; gap: 8px;
  font-size: 11px; color: var(--text-muted);
  cursor: pointer; user-select: none; padding-top: 20px;
}
.toggle {
  width: 34px; height: 18px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 9px; position: relative; transition: background 0.2s; cursor: pointer;
}
.toggle::after {
  content: ''; position: absolute; top: 3px; left: 3px;
  width: 10px; height: 10px; border-radius: 50%;
  background: var(--text-muted); transition: transform 0.2s, background 0.2s;
}
.toggle.on { background: rgba(74,222,128,0.15); border-color: rgba(74,222,128,0.50); }
.toggle.on::after { transform: translateX(16px); background: var(--accent); }

/* â”€â”€ Verify / Attest buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-verify, .btn-attest {
  display: flex; align-items: center; justify-content: center; gap: 10px;
  width: 100%; padding: 15px;
  background: rgba(74,222,128,0.06);
  border: 1px solid rgba(74,222,128,0.25);
  border-radius: var(--radius); color: var(--accent);
  font-size: 12px; font-family: var(--title);
  letter-spacing: 0.14em; cursor: pointer; transition: all 0.2s; margin-top: 8px;
}
.btn-verify:hover:not(:disabled), .btn-attest:hover:not(:disabled) {
  background: rgba(74,222,128,0.10); border-color: rgba(74,222,128,0.55);
  box-shadow: 0 0 30px rgba(74,222,128,0.10); color: #ffffff;
}
.btn-verify:disabled, .btn-attest:disabled { opacity: 0.25; cursor: not-allowed; }
.btn-verify .spinner, .btn-attest .spinner {
  display: none; width: 14px; height: 14px;
  border: 1px solid rgba(74,222,128,0.25); border-top-color: var(--accent);
  border-radius: 50%; animation: spin 0.7s linear infinite;
}
.btn-verify.loading .spinner, .btn-attest.loading .spinner { display: block; }
.btn-verify.loading .btn-text, .btn-attest.loading .btn-text { opacity: 0.5; }

/* â”€â”€ Progress bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-wrap { margin-top: 16px; display: none; }
.progress-wrap.visible { display: block; }
.progress-label { font-size: 10px; color: var(--text-muted); margin-bottom: 6px; letter-spacing: 0.06em; }
.progress-bar-track { height: 2px; background: var(--surface2); border-radius: 1px; overflow: hidden; }
.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), rgba(74,222,128,0.4));
  border-radius: 1px; transition: width 0.15s linear; width: 0%;
  box-shadow: 0 0 8px rgba(74,222,128,0.5);
}

/* â”€â”€ Results (verify) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#results { display: none; animation: fadein 0.4s ease; }
#results.visible { display: block; }

.check-row {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px 0; border-bottom: 1px solid var(--border);
  animation: slidein 0.25s ease both;
}
.check-row:last-child { border-bottom: none; }

.check-icon {
  width: 26px; height: 26px; border-radius: var(--radius-sm);
  display: grid; place-items: center;
  flex-shrink: 0; font-size: 12px; margin-top: 1px; font-family: var(--mono);
}
.check-icon.ok   { background: rgba(74,222,128,0.08);  color: var(--green);  border: 1px solid rgba(74,222,128,0.20); }
.check-icon.fail { background: rgba(248,113,113,0.08); color: var(--red);    border: 1px solid rgba(248,113,113,0.20); }
.check-icon.warn { background: rgba(250,204,21,0.08);  color: var(--amber);  border: 1px solid rgba(250,204,21,0.20); }
.check-icon.skip { background: var(--surface2);        color: var(--text-muted); border: 1px solid var(--border); }

.check-content { flex: 1; min-width: 0; }
.check-title   { font-size: 12px; letter-spacing: 0.04em; margin-bottom: 4px; }
.check-detail  { font-size: 11px; color: var(--text-dim); word-break: break-all; }

.hash-value {
  font-size: 10px; color: var(--text-muted);
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 3px 8px; margin-top: 4px;
  word-break: break-all; display: block;
}
.hash-value.match   { border-color: rgba(74,222,128,0.20);  color: var(--green); background: rgba(74,222,128,0.05); }
.hash-value.mismatch{ border-color: rgba(248,113,113,0.20); color: var(--red);   background: rgba(248,113,113,0.05); }

/* â”€â”€ Trust badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.trust-badge { margin-top: 20px; border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); animation: fadein 0.5s ease 0.2s both; }
.badge-header { padding: 20px 24px; display: flex; align-items: center; gap: 14px; }
.badge-header.trusted { background: rgba(74,222,128,0.06);  border-bottom: 1px solid rgba(74,222,128,0.15); }
.badge-header.peer    { background: rgba(250,204,21,0.05);  border-bottom: 1px solid rgba(250,204,21,0.15); }
.badge-header.self    { background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.06); }
.badge-header.unknown { background: rgba(248,113,113,0.05); border-bottom: 1px solid rgba(248,113,113,0.15); }
.badge-icon { width: 46px; height: 46px; border-radius: var(--radius); display: grid; place-items: center; font-size: 20px; flex-shrink: 0; }
.trusted  .badge-icon { background: rgba(74,222,128,0.08); border: 1px solid rgba(74,222,128,0.20); }
.peer     .badge-icon { background: rgba(250,204,21,0.08); border: 1px solid rgba(250,204,21,0.20); }
.self     .badge-icon { background: var(--surface2);       border: 1px solid var(--border); }
.unknown  .badge-icon { background: rgba(248,113,113,0.08);border: 1px solid rgba(248,113,113,0.20); }
.badge-meta { flex: 1; min-width: 0; }
.badge-developer { font-family: var(--title); font-size: 16px; font-weight: 700; letter-spacing: 0.06em; color: #ffffff; }
.badge-artifact  { font-size: 11px; color: var(--text-muted); }
.badge-level { font-size: 10px; letter-spacing: 0.12em; padding: 5px 12px; border-radius: var(--radius-sm); }
.trusted .badge-level { background: rgba(74,222,128,0.08); color: var(--green); border: 1px solid rgba(74,222,128,0.20); }
.peer    .badge-level { background: rgba(250,204,21,0.08); color: var(--amber); border: 1px solid rgba(250,204,21,0.20); }
.self    .badge-level { background: var(--surface2);       color: var(--text-muted); border: 1px solid var(--border); }
.unknown .badge-level { background: rgba(248,113,113,0.08);color: var(--red);   border: 1px solid rgba(248,113,113,0.20); }
.badge-body { background: rgba(255,255,255,0.01); }
.badge-section { padding: 16px 24px; border-bottom: 1px solid var(--border); }
.badge-section:last-child { border-bottom: none; }
.badge-section-title { font-size: 9px; text-transform: uppercase; letter-spacing: 0.14em; color: var(--text-muted); margin-bottom: 10px; }
.social-list { display: flex; flex-wrap: wrap; gap: 8px; }
.social-chip {
  display: flex; align-items: center; gap: 6px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 5px 10px;
  font-size: 11px; text-decoration: none; color: var(--text-dim); transition: all 0.15s;
}
.social-chip:hover { border-color: rgba(74,222,128,0.40); color: var(--accent); }
.attestation-item { display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 11px; }
.attestation-item:last-child { border-bottom: none; }
.att-valid   { color: var(--green); }
.att-invalid { color: var(--red); }
.att-scope   { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1px 6px; font-size: 10px; color: var(--text-muted); flex-shrink: 0; }
.att-statement { color: var(--text-dim); flex: 1; }
.att-fp { font-size: 10px; color: var(--text-muted); flex-shrink: 0; }
.fp-row { display: flex; align-items: center; gap: 8px; }
.fp-value { font-size: 11px; color: var(--text-muted); word-break: break-all; flex: 1; }
.copy-btn {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 3px 8px;
  font-size: 10px; color: var(--text-muted); cursor: pointer; transition: all 0.15s; flex-shrink: 0;
}
.copy-btn:hover { border-color: rgba(74,222,128,0.40); color: var(--accent); }

/* â”€â”€ Section separator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-sep {
  display: flex; align-items: center; gap: 12px;
  margin: 32px 0; color: var(--text-muted);
  font-size: 9px; text-transform: uppercase; letter-spacing: 0.16em;
}
.section-sep::before, .section-sep::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* â”€â”€ ATTEST â€” Field group â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.field-group { margin-bottom: 14px; }
.field-group:last-child { margin-bottom: 0; }
.field-group label {
  display: block; font-size: 10px; color: var(--text-muted);
  margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.10em;
}
.field-note { font-size: 9px; text-transform: none; letter-spacing: 0; opacity: 0.7; }
.field-group input[type="text"],
.field-group input[type="password"],
.field-group textarea,
.field-group select {
  width: 100%; background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text);
  font-family: var(--mono); font-size: 12px; padding: 10px 14px;
  transition: border-color 0.2s; outline: none; resize: vertical;
}
.field-group input:focus, .field-group textarea:focus, .field-group select:focus {
  border-color: rgba(74,222,128,0.50); box-shadow: 0 0 0 3px rgba(74,222,128,0.06);
}
.field-group select {
  cursor: pointer; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='rgba(255,255,255,0.3)'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
}
.field-group textarea { min-height: 72px; }
.field-group input::placeholder, .field-group textarea::placeholder { color: var(--text-muted); opacity: 0.5; }

/* â”€â”€ ATTEST â€” Key drop zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.key-drop-zone {
  border: 1px dashed rgba(255,255,255,0.10); border-radius: var(--radius);
  padding: 28px 24px; text-align: center; cursor: pointer;
  transition: all 0.25s; position: relative; background: var(--surface2);
}
.key-drop-zone:hover, .key-drop-zone.drag-over {
  border-color: var(--accent); background: rgba(74,222,128,0.03);
}
.key-drop-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.key-drop-zone .drop-icon { font-size: 24px; display: block; margin-bottom: 8px; opacity: 0.6; }
.key-drop-zone .drop-title { font-size: 12px; color: var(--text); margin-bottom: 4px; letter-spacing: 0.04em; }
.key-drop-zone .drop-hint { font-size: 11px; color: var(--text-muted); }
.link-text { color: var(--accent); }

/* â”€â”€ ATTEST â€” Key info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.key-info {
  background: rgba(74,222,128,0.05); border: 1px solid rgba(74,222,128,0.20);
  border-radius: var(--radius); padding: 14px 16px;
}
.key-info-row { display: flex; align-items: center; gap: 12px; }
.key-info-icon { font-size: 20px; flex-shrink: 0; }
.key-info-name { font-size: 12px; color: var(--text); }
.key-info-fp   { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
.remove-btn {
  margin-left: auto; background: none; border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text-muted);
  font-size: 11px; padding: 3px 8px; cursor: pointer; flex-shrink: 0;
  font-family: var(--mono);
}
.remove-btn:hover { border-color: var(--red); color: var(--red); }

/* â”€â”€ ATTEST â€” Or divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.or-divider {
  display: flex; align-items: center; gap: 10px;
  margin: 14px 0; color: var(--text-muted);
  font-size: 10px; text-transform: uppercase; letter-spacing: 0.12em;
}
.or-divider::before, .or-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* â”€â”€ ATTEST â€” Secondary button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-secondary {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 16px; background: var(--surface2);
  border: 1px solid var(--border); border-radius: var(--radius);
  color: var(--text-dim); font-size: 11px; font-family: var(--mono);
  letter-spacing: 0.06em; cursor: pointer; transition: all 0.15s;
}
.btn-secondary:hover { border-color: rgba(74,222,128,0.30); color: var(--accent); }
.btn-secondary:disabled { opacity: 0.4; cursor: not-allowed; }

/* â”€â”€ ATTEST â€” Keygen inline form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.keygen-form {
  margin-top: 14px; padding: 16px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius);
}

/* â”€â”€ ATTEST â€” Result panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.attest-result {
  margin-top: 16px; padding: 20px;
  border-radius: var(--radius); border: 1px solid var(--border);
  background: var(--surface); animation: fadein 0.3s ease;
}
.attest-success { display: flex; gap: 14px; align-items: flex-start; }
.attest-success-icon {
  width: 28px; height: 28px; border-radius: var(--radius-sm);
  background: rgba(74,222,128,0.08); border: 1px solid rgba(74,222,128,0.20);
  display: grid; place-items: center; color: var(--accent);
  font-size: 14px; flex-shrink: 0;
}
.attest-success-title { font-size: 13px; color: var(--accent); margin-bottom: 4px; }
.attest-success-detail { font-size: 11px; color: var(--text-dim); margin-bottom: 10px; }
.attest-link {
  font-size: 11px; color: var(--accent); text-decoration: none;
  border: 1px solid rgba(74,222,128,0.20); border-radius: var(--radius-sm);
  padding: 4px 10px; transition: all 0.15s; display: inline-block;
}
.attest-link:hover { background: rgba(74,222,128,0.08); }

/* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer {
  text-align: center; padding: 32px 0;
  border-top: 1px solid var(--border); margin-top: 64px;
  font-size: 11px; color: var(--text-muted); letter-spacing: 0.04em;
}
footer a { color: var(--accent); text-decoration: none; }
footer a:hover { color: #ffffff; }

/* â”€â”€ SIGN wizard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sign-step {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 12px;
  overflow: hidden;
  transition: border-color 0.2s;
}
.sign-step.active { border-color: rgba(74,222,128,0.30); }

.sign-step-header {
  display: flex; align-items: center; gap: 14px;
  padding: 16px 20px; cursor: pointer; user-select: none;
}
.sign-step-num {
  width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0;
  background: var(--accent-dim); border: 1px solid var(--border-hi);
  display: grid; place-items: center;
  font-size: 11px; color: var(--accent);
  font-family: var(--title); font-weight: 700;
  transition: background 0.2s;
}
.sign-step.done .sign-step-num {
  background: rgba(74,222,128,0.20);
  border-color: var(--accent);
  color: var(--accent);
}
.sign-step-num.check::after { content: 'âœ“'; }
.sign-step-title {
  font-family: var(--title); font-size: 11px;
  letter-spacing: 0.12em; color: var(--text);
  flex: 1;
}
.sign-step-subtitle {
  font-size: 10px; color: var(--text-muted);
  font-family: var(--mono); letter-spacing: 0.04em;
}
.sign-step-arrow {
  font-size: 10px; color: var(--text-muted);
  transition: transform 0.2s;
}
.sign-step.open .sign-step-arrow { transform: rotate(90deg); }

.sign-step-body {
  padding: 0 20px 20px;
  border-top: 1px solid var(--border);
  display: none;
}
.sign-step.open .sign-step-body { display: block; }

/* Command block */
.cmd-block {
  background: #020202;
  border: 1px solid rgba(74,222,128,0.15);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  margin: 14px 0 0;
  position: relative;
  font-family: var(--mono); font-size: 12px;
  color: var(--text); line-height: 1.7;
  white-space: pre-wrap; word-break: break-all;
}
.cmd-block .cmd-comment { color: rgba(74,222,128,0.35); }
.cmd-block .cmd-flag    { color: rgba(74,222,128,0.70); }
.cmd-block .cmd-val     { color: #e2e8f0; }
.cmd-block .cmd-bin     { color: var(--accent); font-weight: bold; }

.btn-copy {
  position: absolute; top: 10px; right: 10px;
  font-family: var(--mono); font-size: 10px;
  background: var(--surface2); border: 1px solid var(--border);
  color: var(--text-muted); border-radius: var(--radius-sm);
  padding: 4px 10px; cursor: pointer;
  transition: all 0.15s; letter-spacing: 0.06em;
}
.btn-copy:hover { border-color: var(--accent); color: var(--accent); }
.btn-copy.copied { border-color: var(--accent); color: var(--accent); }

/* Sign field row */
.sign-fields {
  display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px;
}
.sign-field {
  display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 160px;
}
.sign-field label {
  font-size: 10px; text-transform: uppercase;
  letter-spacing: 0.10em; color: var(--text-muted);
}
.sign-field input, .sign-field select {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text);
  font-family: var(--mono); font-size: 12px; padding: 8px 12px;
  outline: none; transition: border-color 0.2s; width: 100%;
}
.sign-field input:focus, .sign-field select:focus {
  border-color: rgba(74,222,128,0.50);
  box-shadow: 0 0 0 3px rgba(74,222,128,0.06);
}
.sign-field input::placeholder { color: var(--text-muted); opacity: 0.45; }
.sign-field select option { background: #111; }

.sign-tip {
  font-size: 11px; color: var(--text-muted);
  margin-top: 10px; line-height: 1.6;
}
.sign-tip code {
  font-family: var(--mono); font-size: 10px;
  background: rgba(74,222,128,0.07); color: var(--accent);
  padding: 1px 5px; border-radius: var(--radius-sm);
}
.sign-tip a { color: var(--accent); text-decoration: none; }
.sign-tip a:hover { text-decoration: underline; }

/* â”€â”€ Explore tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.explore-section-title { font-size:10px;text-transform:uppercase;letter-spacing:.14em;color:var(--text-muted);border-bottom:1px solid var(--border);padding-bottom:8px;margin-bottom:18px; }
.artifact-card { background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px 22px;margin-bottom:12px;transition:border-color 0.2s;animation:slidein 0.2s ease; }
.artifact-card:hover { border-color:rgba(74,222,128,0.30); }
.att-progress-wrap { background:rgba(255,255,255,0.07);border-radius:2px;height:4px;overflow:hidden; }
.att-progress { height:4px;border-radius:2px;background:var(--accent);transition:width 0.4s ease; }
.community-grid { display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:40px; }
@media (max-width:640px) { .community-grid { grid-template-columns:1fr; } }
.community-card { background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;transition:border-color 0.2s;animation:slidein 0.2s ease; }
.community-card:hover { border-color:rgba(74,222,128,0.25); }
.trust-lvl { font-size:9px;font-family:var(--title);letter-spacing:.10em;font-weight:900;padding:3px 8px;border-radius:var(--radius-sm);flex-shrink:0;align-self:flex-start; }
.trust-lvl.trusted     { background:rgba(74,222,128,0.15);color:var(--accent); }
.trust-lvl.pending     { background:rgba(250,204,21,0.12);color:#facc15; }
.trust-lvl.unverif     { background:rgba(255,255,255,0.06);color:var(--text-muted); }
.trust-lvl.self-signed { background:rgba(168,85,247,0.15);color:#a855f7; }
.score-star { color:var(--accent);font-size:14px;letter-spacing:.04em; }
.fp-chip { display:inline-block;background:rgba(74,222,128,0.10);color:var(--accent);font-family:var(--mono);font-size:10px;padding:2px 7px;border-radius:var(--radius-sm);border:none;cursor:pointer;transition:background 0.15s;letter-spacing:.02em; }
.fp-chip:hover { background:rgba(74,222,128,0.22); }
.fp-modal-overlay { position:fixed;inset:0;background:rgba(0,0,0,0.72);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px; }
.fp-modal-overlay.hidden { display:none !important; }
.fp-modal-box { background:var(--surface);border:1px solid var(--accent);border-radius:3px;padding:28px;max-width:560px;width:100%;position:relative;max-height:90vh;overflow-y:auto; }
.fp-modal-close { position:absolute;top:12px;right:14px;background:none;border:none;color:var(--text-muted);font-size:16px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:var(--radius-sm); }
.fp-modal-close:hover { color:#fff;background:rgba(255,255,255,0.08); }
.explore-empty { text-align:center;padding:60px 0;color:var(--text-muted);font-size:13px; }

/* â”€â”€ Request cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.req-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 24px;
  margin-bottom: 12px;
  display: flex; align-items: flex-start; gap: 18px;
  transition: border-color 0.2s;
  animation: slidein 0.2s ease;
}
.req-card:hover { border-color: rgba(74,222,128,0.20); }

.req-icon {
  width: 40px; height: 40px; flex-shrink: 0;
  border-radius: var(--radius);
  background: var(--accent-dim);
  border: 1px solid var(--border-hi);
  display: grid; place-items: center;
  font-size: 18px;
}

.req-body { flex: 1; min-width: 0; }

.req-name {
  font-family: var(--title);
  font-size: 13px; font-weight: 700;
  color: #fff; letter-spacing: 0.04em;
  margin-bottom: 4px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.req-name .req-version {
  color: var(--accent); font-weight: 400; font-family: var(--mono);
  font-size: 11px; margin-left: 8px;
}

.req-meta {
  font-size: 11px; color: var(--text-muted);
  display: flex; flex-wrap: wrap; gap: 16px;
  margin-bottom: 10px;
}
.req-meta span { display: flex; align-items: center; gap: 5px; }
.req-meta code {
  font-family: var(--mono); font-size: 10px;
  background: rgba(74,222,128,0.06); color: var(--accent);
  padding: 1px 5px; border-radius: var(--radius-sm);
}

.req-pill {
  display: inline-flex; align-items: center; gap: 5px;
  font-size: 10px; padding: 2px 9px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  color: var(--text-muted);
  letter-spacing: 0.04em;
}
.req-pill.need { border-color: rgba(250,204,21,0.30); color: var(--amber); background: var(--amber-dim); }
.req-pill.done { border-color: rgba(74,222,128,0.30); color: var(--accent); background: var(--green-dim); }

.req-actions { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 10px; }

.btn-attest-req {
  font-family: var(--title); font-size: 10px; letter-spacing: 0.10em;
  background: var(--accent-dim); border: 1px solid var(--border-hi);
  color: var(--accent); border-radius: var(--radius-sm);
  padding: 7px 16px; cursor: pointer;
  transition: background 0.15s, box-shadow 0.15s;
}
.btn-attest-req:hover {
  background: rgba(74,222,128,0.15);
  box-shadow: 0 0 12px rgba(74,222,128,0.15);
}

.req-github-link {
  font-size: 11px; color: var(--text-muted);
  text-decoration: none; letter-spacing: 0.04em;
  transition: color 0.15s;
}
.req-github-link:hover { color: var(--text); }

/* â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mono   { font-family: var(--mono); }
.hidden { display: none !important; }

/* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadein    { from { opacity: 0; } to { opacity: 1; } }
@keyframes slidein   { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
@keyframes spin      { to { transform: rotate(360deg); } }
@keyframes glow-pulse {
  0%,100% { box-shadow: 0 0 0 0 transparent; }
  50%      { box-shadow: 0 0 12px rgba(74,222,128,0.25); }
}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 600px) {
  .registry-row { flex-direction: column; }
  .toggle-wrap  { padding-top: 0; }
  .badge-header { flex-wrap: wrap; }
}
</style>
</head>
<body>
<div class="wrapper">

  <!-- Header -->
  <header>
    <div class="logo">

      <!-- Icon -->
      <div class="logo-icon">
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Outer hexagon -->
          <polygon points="15,2 26,8.5 26,21.5 15,28 4,21.5 4,8.5"
            stroke="rgba(74,222,128,0.6)" stroke-width="1" fill="none"/>
          <!-- Inner hexagon -->
          <polygon points="15,7 21.5,10.75 21.5,18.25 15,22 8.5,18.25 8.5,10.75"
            stroke="rgba(74,222,128,0.25)" stroke-width="0.75" fill="rgba(74,222,128,0.04)"/>
          <!-- Shield body -->
          <path d="M15 9.5 L20 12 L20 17 C20 19.5 15 21.5 15 21.5 C15 21.5 10 19.5 10 17 L10 12 Z"
            fill="rgba(74,222,128,0.12)" stroke="rgba(74,222,128,0.8)" stroke-width="1" stroke-linejoin="round"/>
          <!-- Checkmark -->
          <polyline points="12,15.5 14,17.5 18,13.5"
            stroke="#4ade80" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          <!-- Corner accents -->
          <circle cx="15" cy="2"  r="1" fill="rgba(74,222,128,0.7)"/>
          <circle cx="26" cy="8.5"  r="1" fill="rgba(74,222,128,0.4)"/>
          <circle cx="26" cy="21.5" r="1" fill="rgba(74,222,128,0.4)"/>
          <circle cx="15" cy="28" r="1" fill="rgba(74,222,128,0.7)"/>
          <circle cx="4"  cy="21.5" r="1" fill="rgba(74,222,128,0.4)"/>
          <circle cx="4"  cy="8.5"  r="1" fill="rgba(74,222,128,0.4)"/>
        </svg>
      </div>

      <!-- Text -->
      <div class="logo-text">
        <span class="logo-team">Last Paradox Â· Team</span>
        <span class="logo-name">OPEN<span class="logo-accent">TRUST</span></span>
        <span class="logo-product">Sign &amp; Verify</span>
      </div>

    </div>
    <div class="header-badge">v1.0 Â· Ed25519 Â· Web Crypto API</div>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" id="tabVerify">VERIFY</button>
    <button class="tab-btn" id="tabSign">SIGN</button>
    <button class="tab-btn" id="tabAttest">ATTEST</button>
    <button class="tab-btn" id="tabRequests">REQUESTS</button>
    <button class="tab-btn" id="tabExplore">EXPLORE</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VERIFY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="verifyTab">

    <section class="hero">
      <h1>Verify. Without Trust.</h1>
      <p>Validate the integrity of a binary and its developer's identity,<br>
         no server, no account, no upload.</p>
      <div class="zero-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        Zero Upload â€” your file never leaves your computer
      </div>
    </section>

    <div class="card">
      <div class="card-title"><span class="step-num">1</span>Drop your files</div>
      <div class="drop-zone" id="dropZone">
        <input type="file" id="fileInput" multiple accept="*">
        <span class="drop-icon">ğŸ“‚</span>
        <div class="drop-title">Drag your files here</div>
        <div class="drop-hint">
          Drop your <code>binary</code> + your <code>provenance.json</code><br>
          or click to browse
        </div>
      </div>
      <div class="files-list" id="filesList"></div>
    </div>

    <div class="card">
      <div class="card-title"><span class="step-num">2</span>Community registry (optional)</div>
      <div class="registry-row">
        <div class="input-wrap">
          <label>GitHub registry repository</label>
          <input type="text" id="registryInput"
            value="Lastexitfromnowhere/open-trust-registry"
            placeholder="ex: monorg/open-trust-registry"
            autocomplete="off" spellcheck="false">
        </div>
        <label class="toggle-wrap">
          <div class="toggle" id="registryToggle"></div>
          <span>Verify online</span>
        </label>
      </div>
      <p style="font-size:11px;color:var(--text-muted);margin-top:10px;">
        If enabled, the page will query the GitHub API to confirm that your binary's hash
        matches the entry published in the trust registry.
      </p>
    </div>

    <button class="btn-verify" id="btnVerify" disabled>
      <div class="spinner"></div>
      <span class="btn-text">â–¶ &nbsp;VERIFY</span>
    </button>

    <div class="progress-wrap" id="progressWrap">
      <div class="progress-label" id="progressLabel">Computing SHA-256 hashâ€¦</div>
      <div class="progress-bar-track"><div class="progress-bar-fill" id="progressFill"></div></div>
    </div>

    <section id="results">
      <div class="section-sep">Verification results</div>
      <div class="card" id="checksCard">
        <div class="card-title">Cryptographic checks</div>
        <div id="checksList"></div>
      </div>
      <div id="badgeWrap"></div>
    </section>

  </div><!-- #verifyTab -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIGN TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="signTab" class="hidden">

    <section class="hero">
      <h1>Sign your Binary.</h1>
      <p>Step-by-step CLI wizard â€” fill in your details,<br>
         copy the pre-filled commands and run them.</p>
      <div class="zero-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>
        </svg>
        CLI Â· Ed25519 Â· Argon2id encryption
      </div>
    </section>

    <!-- â‘  Install -->
    <div class="sign-step open" id="step1">
      <div class="sign-step-header" data-step="step1">
        <div class="sign-step-num">1</div>
        <div style="flex:1">
          <div class="sign-step-title">INSTALL THE CLI</div>
          <div class="sign-step-subtitle">Build from source â€” Go 1.21+ required</div>
        </div>
        <span class="sign-step-arrow">â–¶</span>
      </div>
      <div class="sign-step-body">
        <div class="sign-fields">
          <div class="sign-field" style="flex:2;min-width:240px;">
            <label>Install directory (optional)</label>
            <input type="text" id="s1Dir" placeholder="~/open-trust-cli" spellcheck="false">
          </div>
        </div>
        <div class="cmd-block" id="cmd1">
<span class="cmd-comment"># Clone and build</span>
<span class="cmd-bin">git</span> clone https://github.com/Lastexitfromnowhere/open-trust-cli.git <span id="c1dir" class="cmd-val">~/open-trust-cli</span>
<span class="cmd-bin">cd</span> <span id="c1dir2" class="cmd-val">~/open-trust-cli</span>
<span class="cmd-bin">go</span> build -o open-trust .</button>
        <button class="btn-copy" data-cmd="cmd1">Copy</button></div>
        <p class="sign-tip">Requires <a href="https://go.dev/dl/" target="_blank">Go 1.21+</a>. The binary <code>open-trust</code> will appear in the directory.</p>
      </div>
    </div>

    <!-- â‘¡ Keygen -->
    <div class="sign-step" id="step2">
      <div class="sign-step-header" data-step="step2">
        <div class="sign-step-num">2</div>
        <div style="flex:1">
          <div class="sign-step-title">CREATE YOUR IDENTITY</div>
          <div class="sign-step-subtitle">Generate an Ed25519 keypair encrypted with Argon2id</div>
        </div>
        <span class="sign-step-arrow">â–¶</span>
      </div>
      <div class="sign-step-body">
        <p class="sign-tip" style="margin-top:8px;">Skip this step if you already have a <code>.key.json</code> file.</p>
        <div class="cmd-block" id="cmd2">
<span class="cmd-comment"># Generates your-name.key.json â€” keep it safe!</span>
<span class="cmd-bin">./open-trust</span> <span class="cmd-flag">keygen</span>
        <button class="btn-copy" data-cmd="cmd2">Copy</button></div>
        <p class="sign-tip">You will be prompted for a <strong>display name</strong> and a <strong>passphrase</strong>.<br>
        âš ï¸ The passphrase cannot be recovered â€” write it down somewhere safe.</p>
      </div>
    </div>

    <!-- â‘¢ Sign -->
    <div class="sign-step" id="step3">
      <div class="sign-step-header" data-step="step3">
        <div class="sign-step-num">3</div>
        <div style="flex:1">
          <div class="sign-step-title">SIGN YOUR BINARY</div>
          <div class="sign-step-subtitle">Hash + Ed25519 signature â†’ provenance.json</div>
        </div>
        <span class="sign-step-arrow">â–¶</span>
      </div>
      <div class="sign-step-body">
        <div class="sign-fields">
          <div class="sign-field">
            <label>App name</label>
            <input type="text" id="s3Name" placeholder="MyApp" spellcheck="false">
          </div>
          <div class="sign-field">
            <label>Version</label>
            <input type="text" id="s3Ver" placeholder="1.0.0" spellcheck="false">
          </div>
          <div class="sign-field" style="flex:2;min-width:200px;">
            <label>Binary path</label>
            <input type="text" id="s3File" placeholder="./myapp.exe" spellcheck="false">
          </div>
          <div class="sign-field">
            <label>Key file</label>
            <input type="text" id="s3Key" placeholder="./my-name.key.json" spellcheck="false">
          </div>
          <div class="sign-field">
            <label>Attestation threshold</label>
            <select id="s3Thresh">
              <option value="1">1 attestation</option>
              <option value="2" selected>2 attestations (default)</option>
              <option value="3">3 attestations</option>
              <option value="5">5 attestations</option>
            </select>
          </div>
        </div>
        <div class="cmd-block" id="cmd3">
<span class="cmd-comment"># Signs the binary and writes provenance.json</span>
<span class="cmd-bin">./open-trust</span> <span class="cmd-flag">sign</span> \
  <span class="cmd-flag">--name</span>      <span class="cmd-val" id="c3name">"MyApp"</span> \
  <span class="cmd-flag">--version</span>   <span class="cmd-val" id="c3ver">"1.0.0"</span> \
  <span class="cmd-flag">--key</span>       <span class="cmd-val" id="c3key">./my-name.key.json</span> \
  <span class="cmd-flag">--threshold</span> <span class="cmd-val" id="c3thresh">2</span> \
  <span class="cmd-val" id="c3file">./myapp.exe</span>
        <button class="btn-copy" data-cmd="cmd3">Copy</button></div>
        <p class="sign-tip">Output: <code>provenance.json</code> in the current directory. Keep it next to your binary.</p>
      </div>
    </div>

    <!-- â‘£ Publish -->
    <div class="sign-step" id="step4">
      <div class="sign-step-header" data-step="step4">
        <div class="sign-step-num">4</div>
        <div style="flex:1">
          <div class="sign-step-title">PUBLISH TO REGISTRY</div>
          <div class="sign-step-subtitle">Push provenance.json to the public trust registry</div>
        </div>
        <span class="sign-step-arrow">â–¶</span>
      </div>
      <div class="sign-step-body">
        <div class="sign-fields">
          <div class="sign-field" style="flex:2;min-width:240px;">
            <label>GitHub token <span style="text-transform:none;letter-spacing:0;font-size:9px;">(public_repo scope)</span></label>
            <input type="password" id="s4Token" placeholder="ghp_xxxxxxxxxxxx" spellcheck="false" autocomplete="off">
          </div>
          <div class="sign-field" style="flex:2;min-width:200px;">
            <label>Registry</label>
            <input type="text" id="s4Registry" value="https://github.com/Lastexitfromnowhere/open-trust-registry.git" spellcheck="false">
          </div>
        </div>
        <div class="cmd-block" id="cmd4">
<span class="cmd-comment"># Windows PowerShell</span>
<span class="cmd-bin">$env:OPEN_TRUST_GITHUB_TOKEN</span> = <span class="cmd-val" id="c4tokWin">"ghp_xxxxxxxxxxxx"</span>
<span class="cmd-bin">./open-trust</span> <span class="cmd-flag">publish</span> <span class="cmd-flag">--registry</span> <span class="cmd-val" id="c4reg">https://github.com/Lastexitfromnowhere/open-trust-registry.git</span>
        <button class="btn-copy" data-cmd="cmd4">Copy</button></div>
        <div class="cmd-block" id="cmd4b" style="margin-top:8px;">
<span class="cmd-comment"># macOS / Linux</span>
<span class="cmd-bin">OPEN_TRUST_GITHUB_TOKEN</span>=<span class="cmd-val" id="c4tokUnix">"ghp_xxxxxxxxxxxx"</span> <span class="cmd-bin">./open-trust</span> <span class="cmd-flag">publish</span> <span class="cmd-flag">--registry</span> <span class="cmd-val" id="c4regUnix">https://github.com/Lastexitfromnowhere/open-trust-registry.git</span>
        <button class="btn-copy" data-cmd="cmd4b">Copy</button></div>
        <p class="sign-tip">Create a token at <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a> â†’ <strong>public_repo</strong> scope only.</p>
      </div>
    </div>

    <!-- â‘¤ Next step callout -->
    <div style="padding:16px 20px;background:var(--accent-dim);border:1px solid var(--border-hi);border-radius:var(--radius);display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
      <div style="font-size:22px;">âœ“</div>
      <div style="flex:1;min-width:200px;">
        <div style="font-family:var(--title);font-size:11px;letter-spacing:.10em;color:var(--accent);margin-bottom:4px;">DONE â€” NOW GET ATTESTATIONS</div>
        <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
          Your <code style="font-family:var(--mono);font-size:10px;background:rgba(74,222,128,0.08);color:var(--accent);padding:1px 5px;border-radius:2px;">provenance.json</code> is published. Head to the <strong>REQUESTS</strong> tab to submit your attestation request â€” no CLI needed, it's all in the browser.
        </div>
      </div>
      <button onclick="switchTab('requests')" style="font-family:var(--title);font-size:10px;letter-spacing:.12em;background:var(--accent);color:#000;border:none;border-radius:var(--radius-sm);padding:10px 20px;cursor:pointer;font-weight:700;white-space:nowrap;">
        GO TO REQUESTS â†’
      </button>
    </div>

  </div><!-- #signTab -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ATTEST TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="attestTab" class="hidden">

    <section class="hero">
      <h1>Attest a Binary.</h1>
      <p>Vouch for someone's binary with your Ed25519 signature.<br>
         Everything happens locally â€” your key never leaves this page.</p>
      <div class="zero-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        Zero Upload â€” signed locally, posted via GitHub API
      </div>
    </section>

    <!-- Card 1: Issue URL -->
    <div class="card">
      <div class="card-title"><span class="step-num">1</span>Attestation request URL</div>
      <div class="field-group">
        <label>GitHub issue URL</label>
        <input type="text" id="issueInput"
          placeholder="https://github.com/owner/open-trust-registry/issues/5"
          autocomplete="off" spellcheck="false">
      </div>
      <div id="issuePreview" class="hidden" style="font-size:11px;color:var(--accent);margin-top:8px;"></div>
    </div>

    <!-- Card 2: Key -->
    <div class="card">
      <div class="card-title"><span class="step-num">2</span>Your signing key</div>

      <!-- Drop zone -->
      <div class="key-drop-zone" id="keyDropZone">
        <input type="file" id="keyFileInput" accept=".json,application/json">
        <span class="drop-icon">ğŸ”‘</span>
        <div class="drop-title">Drop your key.json here</div>
        <div class="drop-hint">or <span class="link-text">click to browse</span></div>
      </div>

      <!-- Key loaded info -->
      <div class="key-info hidden" id="keyInfo">
        <div class="key-info-row">
          <span class="key-info-icon">ğŸ”‘</span>
          <div>
            <div class="key-info-name" id="keyInfoName">Key loaded</div>
            <div class="key-info-fp" id="keyInfoFp"></div>
          </div>
          <button class="remove-btn" id="removeKeyBtn">âœ• remove</button>
        </div>
      </div>

      <!-- Or / generate -->
      <div class="or-divider" id="orDivider"><span>or</span></div>

      <div id="keygenSection">
        <button class="btn-secondary" id="btnShowKeygen">âŠ• Generate a new key</button>
        <div class="keygen-form hidden" id="keygenForm">
          <div class="field-group">
            <label>Your display name</label>
            <input type="text" id="keygenName" placeholder="Alice">
          </div>
          <div class="field-group">
            <label>Passphrase</label>
            <input type="password" id="keygenPass" placeholder="Strong passphrase">
          </div>
          <div class="field-group">
            <label>Confirm passphrase</label>
            <input type="password" id="keygenPassConfirm" placeholder="Repeat passphrase">
          </div>
          <button class="btn-secondary" id="btnGenerate" style="margin-top:4px;">
            â¬‡ Generate &amp; Download identity.key.json
          </button>
          <p style="font-size:10px;color:var(--text-muted);margin-top:8px;">
            Your key is generated locally and encrypted with Argon2id + AES-256-GCM.
            It is compatible with the open-trust CLI.
          </p>
        </div>
      </div>
    </div>

    <!-- Card 3: Attestation details -->
    <div class="card">
      <div class="card-title"><span class="step-num">3</span>Attestation details</div>

      <div class="field-group">
        <label>Your statement</label>
        <textarea id="attestStatement"
          placeholder="I reviewed the source code and it matches this binary"></textarea>
      </div>

      <div class="field-group">
        <label>Scope</label>
        <select id="attestScope">
          <option value="source-review">source-review â€” I verified the source code</option>
          <option value="binary-test">binary-test â€” I tested the binary directly</option>
          <option value="identity-check">identity-check â€” I verified the developer's identity</option>
        </select>
      </div>

      <div class="field-group">
        <label>Key passphrase</label>
        <input type="password" id="attestPass" placeholder="Passphrase for your key.json">
      </div>

      <div class="field-group">
        <label>GitHub token
          <span class="field-note"> Â· needs <code style="font-size:9px;">public_repo</code> scope Â· never leaves your browser</span>
        </label>
        <input type="password" id="attestToken" placeholder="ghp_xxxxxxxxxxxx" autocomplete="off">
        <div style="margin-top:6px;display:flex;align-items:center;gap:7px;font-size:11px;color:var(--text-muted);cursor:pointer;" id="attestTokenRememberRow">
          <div class="toggle" id="attestTokenToggle" style="width:26px;height:14px;"></div>
          <span>Remember on this device</span>
        </div>
      </div>
    </div>

    <!-- Attest button -->
    <button class="btn-attest" id="btnAttest" disabled>
      <div class="spinner"></div>
      <span class="btn-text">â–¶ &nbsp;ATTEST</span>
    </button>

    <!-- Progress -->
    <div class="progress-wrap" id="attestProgressWrap">
      <div class="progress-label" id="attestProgressLabel">Initializingâ€¦</div>
      <div class="progress-bar-track"><div class="progress-bar-fill" id="attestProgressFill"></div></div>
    </div>

    <!-- Result -->
    <div class="attest-result hidden" id="attestResult"></div>

  </div><!-- #attestTab -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REQUESTS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="requestsTab" class="hidden">

    <section class="hero">
      <h1>Open Attestation Requests.</h1>
      <p>Browse binaries waiting for peer review.<br>
         Click <strong>Attest â†’</strong> to vouch for one with your signature.</p>
      <div class="zero-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/>
        </svg>
        Live from the open-trust-registry
      </div>
    </section>

    <!-- Submit a request -->
    <div class="card" id="submitReqCard">
      <div class="card-title" style="cursor:pointer;user-select:none;" id="submitReqToggle">
        <span style="color:var(--accent);margin-right:8px;" id="submitReqArrow">â–¶</span>
        Submit your own attestation request
        <span style="font-size:10px;color:var(--text-muted);font-family:var(--mono);margin-left:10px;font-weight:normal;text-transform:none;letter-spacing:0;">â€” drop your provenance.json here to create a GitHub issue</span>
      </div>

      <div id="submitReqBody" class="hidden">
        <div style="margin-top:16px;">
          <!-- Provenance drop -->
          <div class="key-drop-zone" id="reqProvDrop" style="margin-bottom:14px;">
            <input type="file" id="reqProvInput" accept=".json,application/json">
            <span class="drop-icon">ğŸ“„</span>
            <div class="drop-title">Drop your provenance.json</div>
            <div class="drop-hint">Generated by <code>open-trust sign</code></div>
          </div>
          <div id="reqProvInfo" class="hidden" style="background:var(--surface2);border:1px solid var(--border-hi);border-radius:var(--radius-sm);padding:12px 16px;margin-bottom:14px;font-size:12px;">
            <div id="reqProvSummary" style="color:var(--accent);margin-bottom:4px;font-family:var(--title);font-size:11px;letter-spacing:.06em;"></div>
            <div id="reqProvDetail" style="color:var(--text-muted);font-size:11px;"></div>
          </div>

          <!-- Registry + token row -->
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;">
            <div style="flex:1;min-width:180px;">
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);display:block;margin-bottom:5px;">Registry (GitHub repo)</label>
              <input type="text" id="reqSubmitRegistry"
                value="Lastexitfromnowhere/open-trust-registry"
                style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;"
                spellcheck="false" autocomplete="off">
            </div>
            <div style="flex:1;min-width:180px;">
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);display:block;margin-bottom:5px;">GitHub Token <span style="text-transform:none;letter-spacing:0;">(public_repo scope)</span></label>
              <input type="password" id="reqSubmitToken"
                placeholder="ghp_xxxxxxxxxxxx"
                style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;"
                spellcheck="false" autocomplete="off">
              <div style="margin-top:5px;display:flex;align-items:center;gap:7px;font-size:11px;color:var(--text-muted);cursor:pointer;" id="reqTokenRememberRow">
                <div class="toggle" id="reqTokenToggle" style="width:26px;height:14px;"></div>
                <span>Remember on this device</span>
              </div>
            </div>
          </div>

          <!-- Optional message -->
          <div style="margin-bottom:14px;">
            <label style="font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);display:block;margin-bottom:5px;">Message (optional)</label>
            <input type="text" id="reqSubmitMessage"
              placeholder="Tested on Windows 11 and macOS 14â€¦"
              style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;"
              spellcheck="false" autocomplete="off">
          </div>

          <button id="btnSubmitReq" class="btn-verify" style="margin:0;" disabled>
            <div class="spinner" id="submitReqSpinner" style="display:none;"></div>
            <span id="submitReqBtnText">â–¶ &nbsp;OPEN ISSUE</span>
          </button>

          <div id="submitReqResult" class="hidden" style="margin-top:14px;"></div>
        </div>
      </div>
    </div>

    <!-- Registry selector + list -->
    <div class="card" style="padding:16px 24px;margin-bottom:20px;">
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
        <div style="flex:1;min-width:200px;">
          <label style="font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);display:block;margin-bottom:5px;">Browse registry</label>
          <input type="text" id="reqRegistryInput"
            value="Lastexitfromnowhere/open-trust-registry"
            style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;"
            spellcheck="false" autocomplete="off">
        </div>
        <button id="btnRefreshRequests" class="btn-verify" style="padding:9px 22px;margin:0;align-self:flex-end;font-size:11px;min-width:auto;">
          <div class="spinner" id="reqSpinner" style="display:none;"></div>
          <span id="reqBtnText">â†» &nbsp;LOAD</span>
        </button>
      </div>
    </div>

    <div id="reqEmpty" class="hidden" style="text-align:center;padding:60px 0;color:var(--text-muted);font-size:13px;">
      No open attestation requests found.
    </div>
    <div id="reqError" class="hidden" style="text-align:center;padding:40px 0;color:var(--red);font-size:13px;"></div>

    <div id="reqList"></div>

  </div><!-- #requestsTab -->
<div id="exploreTab" class="hidden">
  <section class="hero">
    <h1>Trust Graph.</h1>
    <p>All signed artifacts and community members indexed from the registry.<br>
       Click any fingerprint to see a developerâ€™s full profile.</p>
    <div class="zero-badge">Decentralized Â· Transparent Â· Community-driven</div>
  </section>
  <div class="card" style="padding:16px 24px;margin-bottom:28px;">
    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
      <input id="exploreSlug" type="text"
        value="Lastexitfromnowhere/open-trust-registry"
        placeholder="owner/repo"
        style="flex:1;min-width:220px;font-family:var(--mono);font-size:12px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 12px;color:var(--text);">
      <button id="btnLoadExplore"
        style="font-family:var(--title);font-size:10px;letter-spacing:.12em;background:var(--accent);color:#000;border:none;border-radius:var(--radius-sm);padding:10px 20px;cursor:pointer;font-weight:700;white-space:nowrap;">
        LOAD
      </button>
    </div>
    <div style="font-size:10px;color:var(--text-muted);margin-top:8px;">
      Token recommended for large registries â€” set it in any other tabâ€™s settings.
    </div>
  </div>
  <div id="exploreStatus" class="hidden" style="text-align:center;padding:20px;color:var(--text-muted);font-size:12px;"></div>
  <div id="exploreError" class="hidden" style="text-align:center;padding:16px;color:var(--red);font-size:12px;background:rgba(239,68,68,0.08);border-radius:var(--radius);border:1px solid rgba(239,68,68,0.20);margin-bottom:20px;"></div>
  <div id="exploreArtifacts" class="hidden">
    <div class="explore-section-title">Signed Artifacts</div>
    <div id="artifactList"></div>
  </div>
  <div id="exploreCommunity" class="hidden">
    <div class="explore-section-title" style="margin-top:40px;">Community Members</div>
    <div class="community-grid" id="communityGrid"></div>
  </div>
</div><!-- #exploreTab -->

<div id="fpModal" class="fp-modal-overlay hidden">
  <div class="fp-modal-box">
    <button class="fp-modal-close" id="fpModalClose">âœ•</button>
    <div id="fpModalContent"></div>
  </div>
</div>
</div><!-- .wrapper -->

<footer>
  <p>
    <strong>OPEN-TRUST</strong> is open-source Â· No data is sent to any server Â·
    Verification powered by <a href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto" target="_blank">WebCrypto API</a>
    (SHA-256, SHA-512, Ed25519)
  </p>
  <p style="margin-top:6px;">
    <a href="https://github.com/Lastexitfromnowhere/open-trust-cli" target="_blank">GitHub</a> Â·
    CLI: <code style="font-size:11px;">open-trust verify ./binary</code>
  </p>
</footer>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const hexEncode = buf =>
  Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');

const base64urlDecode = str => {
  str = str.replace(/-/g,'+').replace(/_/g,'/');
  while (str.length % 4) str += '=';
  return Uint8Array.from(atob(str), c => c.charCodeAt(0));
};

const base64urlEncode = bytes => {
  let bin = '';
  for (let i = 0; i < bytes.length; i++) bin += String.fromCharCode(bytes[i]);
  return btoa(bin).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');
};

function nowUTC() {
  return new Date().toISOString().replace(/\.\d{3}Z$/, 'Z');
}

function formatSize(n) {
  if (n >= 1e9) return (n/1e9).toFixed(1)+' GB';
  if (n >= 1e6) return (n/1e6).toFixed(1)+' MB';
  if (n >= 1e3) return (n/1e3).toFixed(1)+' KB';
  return n+' B';
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB SWITCHING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const tabVerify    = document.getElementById('tabVerify');
const tabSign      = document.getElementById('tabSign');
const tabAttest    = document.getElementById('tabAttest');
const tabRequests  = document.getElementById('tabRequests');
const tabExplore   = document.getElementById('tabExplore');
const verifyTab    = document.getElementById('verifyTab');
const signTab      = document.getElementById('signTab');
const attestTab    = document.getElementById('attestTab');
const requestsTab  = document.getElementById('requestsTab');
const exploreTab   = document.getElementById('exploreTab');

// Requests browse consts â€” declared here so fetchRequests() (called from switchTab) can access them
const reqRegistryInput   = document.getElementById('reqRegistryInput');
const btnRefreshRequests = document.getElementById('btnRefreshRequests');
const reqSpinner         = document.getElementById('reqSpinner');
const reqBtnText         = document.getElementById('reqBtnText');
const reqList            = document.getElementById('reqList');
const reqEmpty           = document.getElementById('reqEmpty');
const reqError           = document.getElementById('reqError');

let argon2Ready    = false;
let requestsLoaded = false;

tabVerify.addEventListener('click',   () => switchTab('verify'));
tabSign.addEventListener('click',     () => switchTab('sign'));
tabAttest.addEventListener('click',   () => switchTab('attest'));
tabRequests.addEventListener('click', () => switchTab('requests'));
tabExplore.addEventListener('click',  () => switchTab('explore'));

async function switchTab(tab) {
  [verifyTab, signTab, attestTab, requestsTab, exploreTab].forEach(el => el.classList.add('hidden'));
  [tabVerify, tabSign, tabAttest, tabRequests, tabExplore].forEach(el => el.classList.remove('active'));

  if (tab === 'sign') {
    signTab.classList.remove('hidden');
    tabSign.classList.add('active');
  } else if (tab === 'attest') {
    attestTab.classList.remove('hidden');
    tabAttest.classList.add('active');
    if (!argon2Ready) loadArgon2();
  } else if (tab === 'requests') {
    requestsTab.classList.remove('hidden');
    tabRequests.classList.add('active');
    if (!requestsLoaded) { requestsLoaded = true; fetchRequests(); }
  } else if (tab === 'explore') {
    exploreTab.classList.remove('hidden');
    tabExplore.classList.add('active');
  } else {
    verifyTab.classList.remove('hidden');
    tabVerify.classList.add('active');
  }
}

function loadArgon2() {
  return new Promise((resolve, reject) => {
    if (window.argon2) { argon2Ready = true; resolve(); return; }
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/argon2-browser@1.18.0/dist/argon2-bundled.min.js';
    s.onload = () => { argon2Ready = true; resolve(); };
    s.onerror = () => reject(new Error('Failed to load Argon2 library'));
    document.head.appendChild(s);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VERIFY TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const verifyState = { binaryFile: null, provenanceFile: null, registryOn: false };

const dropZone       = document.getElementById('dropZone');
const fileInput      = document.getElementById('fileInput');
const filesList      = document.getElementById('filesList');
const registryInput  = document.getElementById('registryInput');
const registryToggle = document.getElementById('registryToggle');
const btnVerify      = document.getElementById('btnVerify');
const progressWrap   = document.getElementById('progressWrap');
const progressFill   = document.getElementById('progressFill');
const progressLabel  = document.getElementById('progressLabel');
const results        = document.getElementById('results');
const checksList     = document.getElementById('checksList');
const badgeWrap      = document.getElementById('badgeWrap');

async function readFileAsArrayBuffer(file, onProgress) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onprogress = e => { if (e.lengthComputable && onProgress) onProgress(e.loaded, e.total); };
    reader.onload  = e => resolve(e.target.result);
    reader.onerror = () => reject(reader.error);
    reader.readAsArrayBuffer(file);
  });
}

async function sha256ofBytes(bytes) {
  return hexEncode(await crypto.subtle.digest('SHA-256', bytes));
}

async function detectFileType(file) {
  try {
    const obj = JSON.parse(await file.slice(0, 4096).text());
    if (obj.schema_version && obj.artifact && obj.signature) return 'provenance';
    return 'unknown';
  } catch { return 'binary'; }
}

async function handleFiles(files) {
  for (const file of files) {
    const type = await detectFileType(file);
    if (type === 'provenance') verifyState.provenanceFile = file;
    else verifyState.binaryFile = file;
  }
  renderFilesPills();
  updateVerifyBtn();
}

function renderFilesPills() {
  filesList.innerHTML = '';
  if (verifyState.binaryFile)    filesList.innerHTML += filePill(verifyState.binaryFile, 'binary', 'â¬¡');
  if (verifyState.provenanceFile) filesList.innerHTML += filePill(verifyState.provenanceFile, 'provenance', 'ğŸ“„');
}

function filePill(f, type, icon) {
  return `<div class="file-pill type-${type}"><span class="dot"></span>${icon} ${f.name} <span style="opacity:.5">(${formatSize(f.size)})</span></div>`;
}

function updateVerifyBtn() {
  btnVerify.disabled = !(verifyState.binaryFile && verifyState.provenanceFile);
}

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('drag-over'); handleFiles([...e.dataTransfer.files]); });
fileInput.addEventListener('change', () => handleFiles([...fileInput.files]));
registryToggle.addEventListener('click', () => {
  verifyState.registryOn = !verifyState.registryOn;
  registryToggle.classList.toggle('on', verifyState.registryOn);
});

async function hashFile(file) {
  progressWrap.classList.add('visible');
  progressLabel.textContent = 'Computing SHA-256 + SHA-512â€¦';
  progressFill.style.width = '0%';
  const buffer = await readFileAsArrayBuffer(file, (loaded, total) => {
    progressFill.style.width = (loaded / total * 85).toFixed(0) + '%';
    progressLabel.textContent = `Hashingâ€¦ ${formatSize(loaded)} / ${formatSize(total)}`;
  });
  progressLabel.textContent = 'Finalizing digestsâ€¦';
  progressFill.style.width = '90%';
  const [s256, s512] = await Promise.all([
    crypto.subtle.digest('SHA-256', buffer),
    crypto.subtle.digest('SHA-512', buffer),
  ]);
  progressFill.style.width = '100%';
  await sleep(200);
  progressWrap.classList.remove('visible');
  return { sha256: hexEncode(s256), sha512: hexEncode(s512) };
}

async function verifyEd25519(pubkeyB64url, payloadStr, sigB64url) {
  try {
    const key = await crypto.subtle.importKey('raw', base64urlDecode(pubkeyB64url), {name:'Ed25519'}, false, ['verify']);
    return await crypto.subtle.verify({name:'Ed25519'}, key, base64urlDecode(sigB64url), new TextEncoder().encode(payloadStr));
  } catch(e) {
    if (e.name === 'NotSupportedError' || e.name === 'DOMException') return null;
    throw e;
  }
}

async function fetchFromGitHub(repo, fingerprint, sha256) {
  const url = `https://api.github.com/repos/${repo}/contents/keys/${fingerprint}/signatures/${sha256}.json`;
  const res = await fetch(url, { headers: { Accept: 'application/vnd.github.v3+json' } });
  if (!res.ok) return null;
  const data = await res.json();
  return JSON.parse(atob(data.content.replace(/\n/g,'')));
}

btnVerify.addEventListener('click', async () => {
  btnVerify.classList.add('loading'); btnVerify.disabled = true;
  results.classList.remove('visible'); checksList.innerHTML = ''; badgeWrap.innerHTML = '';
  try { await runVerification(); }
  catch(err) { addCheck('fail', 'Unexpected error', err.message); }
  finally { btnVerify.classList.remove('loading'); btnVerify.disabled = false; results.classList.add('visible'); }
});

async function runVerification() {
  let prov;
  try { prov = JSON.parse(await verifyState.provenanceFile.text()); }
  catch { addCheck('fail', 'Invalid provenance.json', 'The file could not be parsed as JSON. Make sure you dropped the correct file.'); return; }

  const { sha256, sha512 } = await hashFile(verifyState.binaryFile);

  const sha256ok = sha256 === prov.artifact?.sha256;
  addCheck(sha256ok?'ok':'fail', sha256ok?'SHA-256 integrity verified':'SHA-256 integrity failed',
    sha256ok ? 'The hash matches the one signed by the developer.'
             : 'The binary was modified after signing. Do not install this file.',
    [{ label:'Computed', value:sha256, match:sha256ok }, { label:'Signed', value:prov.artifact?.sha256??'â€”', match:sha256ok }]);
  if (!sha256ok) { finalizeBadge(prov,0,false); return; }

  const sha512ok = sha512 === prov.artifact?.sha512;
  addCheck(sha512ok?'ok':'fail', sha512ok?'SHA-512 integrity verified':'SHA-512 integrity failed',
    sha512ok ? 'Secondary check passed as well.' : 'SHA-512 hash mismatch â€” the file is compromised.',
    sha512ok ? [{label:sha512.slice(0,32)+'â€¦',value:'',match:true}] : []);

  let fpOk = false;
  try {
    fpOk = (await sha256ofBytes(base64urlDecode(prov.identity?.pubkey_ed25519??''))) === prov.identity?.pubkey_fingerprint;
    addCheck(fpOk?'ok':'fail', fpOk?'Key fingerprint consistent':'Key fingerprint mismatch',
      fpOk ? 'The public key matches the fingerprint declared in the manifest.'
           : 'The manifest was tampered with â€” key and fingerprint no longer match.');
  } catch {
    addCheck('fail','Malformed public key','Unable to decode the public key from the manifest.');
    finalizeBadge(prov,0,false); return;
  }

  const sigPayload = `${prov.artifact.sha256}|${prov.artifact.sha512}|${prov.signature?.timestamp}`;
  const sigValid   = await verifyEd25519(prov.identity?.pubkey_ed25519, sigPayload, prov.signature?.value);
  if (sigValid === null) {
    addCheck('warn','Ed25519 signature (not verified)',
      'Your browser does not support Ed25519 via WebCrypto (requires Chrome 113+, Firefox 116+, Safari 17+).\nUse the open-trust CLI for full verification.');
  } else {
    addCheck(sigValid?'ok':'fail', sigValid?'Ed25519 signature valid':'Ed25519 signature INVALID',
      sigValid ? `Signed by ${prov.identity?.display_name??'unknown'} on ${prov.signature?.timestamp??'?'}`
               : 'The cryptographic signature is invalid â€” the manifest has been forged.\nDo not install this binary.');
    if (!sigValid) { finalizeBadge(prov,0,false); return; }
  }

  const attestations = prov.attestations ?? [];
  const threshold    = prov.trust_chain?.threshold ?? 2;
  let validAtts = 0; const attDetails = [];
  for (const att of attestations) {
    const valid = await verifyEd25519(att.attester_pubkey, `${prov.artifact.sha256}|${att.statement}|${att.timestamp}`, att.signature);
    if (valid === true) validAtts++;
    attDetails.push({...att, valid});
  }
  if (attestations.length === 0) {
    addCheck('warn','No peer attestations','This binary has not yet been validated by peers. Trust level: SELF-SIGNED.');
  } else {
    const ok = validAtts >= threshold;
    addCheck(ok?'ok':'warn',
      ok ? `Attestations verified (${validAtts}/${threshold})` : `Insufficient attestations (${validAtts}/${threshold} required)`,
      ok ? `Trust threshold reached â€” this artifact is <span style="color:var(--green);font-weight:700">TRUSTED</span>.`
         : `${threshold-validAtts} more peer attestation(s) needed to reach TRUSTED status.`);
  }

  const repo = registryInput.value.trim();
  if (verifyState.registryOn && repo) {
    try {
      const remote = await fetchFromGitHub(repo, prov.identity.pubkey_fingerprint, sha256);
      if (!remote)                          addCheck('warn','Not found in registry',`No published entry in ${repo} for this hash.\nPublish with: open-trust publish --registry git@github.com:${repo}.git`);
      else if (remote.artifact?.sha256 !== sha256) addCheck('fail','Registry mismatch','The hash in the registry does not match the local file. Security alert.');
      else                                  addCheck('ok','Community registry confirmed',`Hash matches the published entry in ${repo}.`);
    } catch(e) { addCheck('warn','Registry unreachable',`Could not contact the GitHub API: ${e.message}`); }
  } else if (verifyState.registryOn && !repo) {
    addCheck('skip','Registry not configured','Enter a GitHub repository URL to enable online verification.');
  }

  finalizeBadge(prov, validAtts, true, attDetails, threshold);
}

function addCheck(status, title, detail, hashes=[]) {
  const icons = {ok:'âœ“',fail:'âœ—',warn:'!',skip:'â€“'};
  const colors = {ok:'var(--green)',fail:'var(--red)',warn:'var(--amber)',skip:'var(--text-muted)'};
  const delay = checksList.children.length * 80;
  const row = document.createElement('div');
  row.className = 'check-row'; row.style.animationDelay = delay+'ms';
  const hashesHTML = hashes.map(h => h.value
    ? `<div style="margin-top:6px;"><span style="font-size:10px;color:var(--text-muted)">${h.label}: </span><code class="hash-value ${h.match?'match':'mismatch'}">${h.value}</code></div>`
    : `<span style="font-size:11px;color:var(--text-muted)">${h.label}</span>`).join('');
  row.innerHTML = `<div class="check-icon ${status}">${icons[status]}</div>
    <div class="check-content">
      <div class="check-title" style="color:${colors[status]}">${title}</div>
      <div class="check-detail">${detail.replace(/\n/g,'<br>')}</div>
      ${hashesHTML}
    </div>`;
  checksList.appendChild(row);
}

function finalizeBadge(prov, validAtts, checksOk, attDetails=[], threshold=2) {
  const name=prov.identity?.display_name??'Unknown', artName=prov.artifact?.name??'',
        artVer=prov.artifact?.version??'', fp=prov.identity?.pubkey_fingerprint??'',
        ts=prov.signature?.timestamp??'', proofs=prov.identity?.social_proofs??[];
  let level,levelLabel,icon;
  if (!checksOk)             { level='unknown'; levelLabel='INVALID';       icon='âœ—'; }
  else if (validAtts>=threshold) { level='trusted'; levelLabel='TRUSTED';       icon='âœ“'; }
  else if (validAtts>0)      { level='peer';    levelLabel='PEER-ATTESTED'; icon='â—'; }
  else if (proofs.length>0)  { level='self';    levelLabel='SELF-SIGNED';   icon='â—‰'; }
  else                       { level='unknown'; levelLabel='UNKNOWN';       icon='?'; }

  const pIcons={github:'ğŸ™',mastodon:'ğŸ˜',keybase:'ğŸ”‘',gitlab:'ğŸ¦Š',twitter:'ğŸ¦',x:'âœ–'};
  const socialHTML = proofs.map(sp=>`<a class="social-chip" href="${sp.proof_url}" target="_blank" rel="noopener"><span class="platform-icon">${pIcons[sp.platform?.toLowerCase()]??'ğŸŒ'}</span>${sp.platform} Â· ${sp.handle}</a>`).join('');
  const attsHTML = attDetails.length===0
    ? '<p style="font-size:11px;color:var(--text-muted)">No attestations.</p>'
    : attDetails.map(att=>`<div class="attestation-item">
        <span class="${att.valid===true?'att-valid':att.valid===false?'att-invalid':''}">${att.valid===true?'âœ“':att.valid===false?'âœ—':'~'}</span>
        <span class="att-scope">${att.scope??""}</span>
        <span class="att-statement">${att.statement??""}</span>
        <button class="fp-chip" onclick="openFpModal('${att.attester_fingerprint}',event)" style="font-size:10px;">${att.attester_fingerprint?.slice(0,12)??''}â€¦</button>
      </div>`).join('');

  badgeWrap.innerHTML = `<div class="trust-badge">
    <div class="badge-header ${level}">
      <div class="badge-icon">${level==='trusted'?'ğŸ›¡ï¸':level==='peer'?'ğŸ”':level==='self'?'ğŸ”':'âš ï¸'}</div>
      <div class="badge-meta">
        <div class="badge-developer">${name}</div>
        <div class="badge-artifact mono">${artName} ${artVer} Â· ${ts.slice(0,10)}</div>
      </div>
      <div class="badge-level">${icon} ${levelLabel}</div>
    </div>
    <div class="badge-body">
      ${proofs.length>0?`<div class="badge-section"><div class="badge-section-title">Social identity</div><div class="social-list">${socialHTML}</div></div>`:''}
      <div class="badge-section"><div class="badge-section-title">Peer attestations (${validAtts} / ${threshold} required)</div>${attsHTML}</div>
      <div class="badge-section">
        <div class="badge-section-title">Key fingerprint</div>
        <div class="fp-row"><span class="fp-value mono">${fp}</span><button class="copy-btn" onclick="copyFP('${fp}')">copy</button></div>
        <p style="font-size:11px;color:var(--text-muted);margin-top:6px;">Cross-check this fingerprint against the developer's public profile to confirm their identity.</p>
      </div>
    </div>
  </div>`;
}

function copyFP(fp) {
  navigator.clipboard.writeText(fp).then(() => {
    const btn = document.querySelector('.copy-btn');
    if (btn) { btn.textContent='copied!'; setTimeout(()=>btn.textContent='copy',2000); }
  });
}

// Ed25519 browser support hint
(async () => {
  try { await crypto.subtle.importKey('raw',new Uint8Array(32),{name:'Ed25519'},false,['verify']); }
  catch {
    const hint = document.createElement('p');
    hint.style.cssText='text-align:center;font-size:11px;color:var(--amber);padding:8px 0';
    hint.textContent='âš  Your browser does not support Ed25519 SubtleCrypto â€” signature verification will be skipped. Use Chrome 113+, Firefox 116+, or Safari 17+.';
    document.querySelector('.hero')?.appendChild(hint);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ATTEST TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const attestState = { keystore: null };

const issueInput        = document.getElementById('issueInput');
const issuePreview      = document.getElementById('issuePreview');
const keyDropZone       = document.getElementById('keyDropZone');
const keyFileInput      = document.getElementById('keyFileInput');
const keyInfo           = document.getElementById('keyInfo');
const keyInfoName       = document.getElementById('keyInfoName');
const keyInfoFp         = document.getElementById('keyInfoFp');
const removeKeyBtn      = document.getElementById('removeKeyBtn');
const orDivider         = document.getElementById('orDivider');
const keygenSection     = document.getElementById('keygenSection');
const btnShowKeygen     = document.getElementById('btnShowKeygen');
const keygenForm        = document.getElementById('keygenForm');
const keygenName        = document.getElementById('keygenName');
const keygenPass        = document.getElementById('keygenPass');
const keygenPassConfirm = document.getElementById('keygenPassConfirm');
const btnGenerate       = document.getElementById('btnGenerate');
const attestStatement   = document.getElementById('attestStatement');
const attestScope       = document.getElementById('attestScope');
const attestPass        = document.getElementById('attestPass');
const attestToken       = document.getElementById('attestToken');
const btnAttest         = document.getElementById('btnAttest');
const attestProgressWrap= document.getElementById('attestProgressWrap');
const attestProgressFill= document.getElementById('attestProgressFill');
const attestProgressLabel=document.getElementById('attestProgressLabel');
const attestResult      = document.getElementById('attestResult');

// â”€â”€ Issue URL input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseIssueURL(url) {
  const m = url.trim().match(/^https:\/\/github\.com\/([^/]+)\/([^/]+)\/issues\/(\d+)/);
  if (!m) return null;
  return { owner: m[1], repo: m[2], number: parseInt(m[3]) };
}

issueInput.addEventListener('input', () => {
  const parsed = parseIssueURL(issueInput.value);
  if (parsed) {
    issuePreview.textContent = `âœ“ Issue #${parsed.number} in ${parsed.owner}/${parsed.repo}`;
    issuePreview.classList.remove('hidden');
    issuePreview.style.color = 'var(--accent)';
  } else if (issueInput.value.length > 10) {
    issuePreview.textContent = 'Invalid URL â€” paste a GitHub issue URL';
    issuePreview.classList.remove('hidden');
    issuePreview.style.color = 'var(--red)';
  } else {
    issuePreview.classList.add('hidden');
  }
  updateAttestBtn();
});

// â”€â”€ Key drag-and-drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
keyDropZone.addEventListener('dragover', e => { e.preventDefault(); keyDropZone.classList.add('drag-over'); });
keyDropZone.addEventListener('dragleave', () => keyDropZone.classList.remove('drag-over'));
keyDropZone.addEventListener('drop', e => { e.preventDefault(); keyDropZone.classList.remove('drag-over'); if(e.dataTransfer.files[0]) loadKeyFile(e.dataTransfer.files[0]); });
keyFileInput.addEventListener('change', () => { if(keyFileInput.files[0]) loadKeyFile(keyFileInput.files[0]); });

async function loadKeyFile(file) {
  try {
    const ks = JSON.parse(await file.text());
    if (ks.algorithm !== 'argon2id+aes256gcm' || !ks.salt || !ks.ciphertext) {
      throw new Error('Not a valid open-trust key file');
    }
    setKeyLoaded(ks, file.name);
  } catch(e) {
    alert('Invalid key file: ' + e.message);
  }
}

function setKeyLoaded(ks, filename) {
  attestState.keystore = ks;
  keyDropZone.classList.add('hidden');
  orDivider.classList.add('hidden');
  keygenSection.classList.add('hidden');
  keyInfo.classList.remove('hidden');
  keyInfoName.textContent = filename || 'Key loaded';
  keyInfoFp.textContent = 'Fingerprint: ' + ks.fingerprint.slice(0,16) + 'â€¦';
  updateAttestBtn();
}

removeKeyBtn.addEventListener('click', () => {
  attestState.keystore = null;
  keyInfo.classList.add('hidden');
  keyDropZone.classList.remove('hidden');
  orDivider.classList.remove('hidden');
  keygenSection.classList.remove('hidden');
  keyFileInput.value = '';
  updateAttestBtn();
});

// â”€â”€ Keygen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnShowKeygen.addEventListener('click', () => {
  keygenForm.classList.toggle('hidden');
  btnShowKeygen.textContent = keygenForm.classList.contains('hidden')
    ? 'âŠ• Generate a new key'
    : 'âœ• Cancel';
});

btnGenerate.addEventListener('click', async () => {
  const name        = keygenName.value.trim();
  const pass        = keygenPass.value;
  const passConfirm = keygenPassConfirm.value;
  if (!name)             { alert('Enter a display name'); return; }
  if (!pass)             { alert('Enter a passphrase'); return; }
  if (pass !== passConfirm) { alert('Passphrases do not match'); return; }

  btnGenerate.disabled = true;
  btnGenerate.textContent = 'Generatingâ€¦ (this takes a few seconds)';

  try {
    if (!argon2Ready) await loadArgon2();
    const { keystore } = await generateKeyInBrowser(name, pass);

    // Download
    const blob = new Blob([JSON.stringify(keystore, null, 2)], {type:'application/json'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url; a.download = 'identity.key.json'; a.click();
    URL.revokeObjectURL(url);

    // Auto-load
    setKeyLoaded(keystore, 'identity.key.json');
    keygenForm.classList.add('hidden');

  } catch(e) {
    alert('Key generation failed: ' + e.message);
  } finally {
    btnGenerate.disabled = false;
    btnGenerate.textContent = 'â¬‡ Generate & Download identity.key.json';
  }
});

// â”€â”€ Attest button state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[issueInput, attestStatement, attestPass, attestToken].forEach(el =>
  el.addEventListener('input', updateAttestBtn));

function updateAttestBtn() {
  btnAttest.disabled = !(
    parseIssueURL(issueInput.value) &&
    attestState.keystore &&
    attestStatement.value.trim().length > 0 &&
    attestPass.value.length > 0 &&
    attestToken.value.trim().length > 0
  );
}

// â”€â”€ Attest flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnAttest.addEventListener('click', async () => {
  btnAttest.classList.add('loading');
  btnAttest.disabled = true;
  attestResult.classList.add('hidden');
  attestProgressWrap.classList.add('visible');
  attestProgressFill.style.width = '0%';

  try {
    await runAttestation();
  } catch(e) {
    showAttestError(e.message);
  } finally {
    btnAttest.classList.remove('loading');
    btnAttest.disabled = false;
    await sleep(400);
    attestProgressWrap.classList.remove('visible');
    attestProgressFill.style.width = '0%';
  }
});

function setAttestProgress(label, pct) {
  attestProgressLabel.textContent = label;
  attestProgressFill.style.width = pct + '%';
}

async function runAttestation() {
  const token     = attestToken.value.trim();
  const statement = attestStatement.value.trim();
  const scope     = attestScope.value;
  const passphrase= attestPass.value;

  // 1. Fetch provenance.json from GitHub issue
  setAttestProgress('Fetching issue from GitHubâ€¦', 15);
  const { provenance, owner, repo, number } = await fetchProvenanceFromIssue(issueInput.value, token);

  // 2. Ensure argon2 is loaded
  setAttestProgress('Loading cryptographic libraryâ€¦', 25);
  if (!argon2Ready) await loadArgon2();

  // 3. Decrypt key
  setAttestProgress('Deriving key (Argon2id)â€¦ this takes a few seconds', 40);
  let keyData;
  try {
    keyData = await decryptKeystore(attestState.keystore, passphrase);
  } catch {
    throw new Error('Wrong passphrase or corrupted key file. Please try again.');
  }

  // 4. Guards
  if (keyData.fingerprint === provenance.identity.pubkey_fingerprint) {
    throw new Error('Self-attestation is not allowed. You cannot attest your own binary.');
  }
  const alreadyDone = (provenance.attestations || []).some(a => a.attester_fingerprint === keyData.fingerprint);
  if (alreadyDone) {
    throw new Error('You have already attested this binary with this key.');
  }

  // 5. Sign
  setAttestProgress('Signing attestation with Ed25519â€¦', 70);
  const timestamp = nowUTC();
  const sigBytes  = await signAttestation(keyData.privateKey, provenance.artifact.sha256, statement, timestamp);

  // 6. Build attestation + append
  const attestation = {
    attester_pubkey:      base64urlEncode(keyData.pubkeyBytes),
    attester_fingerprint: keyData.fingerprint,
    statement,
    scope,
    signature:  base64urlEncode(sigBytes),
    timestamp,
  };
  const updated = { ...provenance, attestations: [...(provenance.attestations || []), attestation] };

  // 7. Post comment
  setAttestProgress('Posting attestation to GitHubâ€¦', 88);
  const commentURL = await postAttestedComment(owner, repo, number, token, updated, keyData.fingerprint);

  setAttestProgress('Done!', 100);
  showAttestSuccess(owner, repo, number, commentURL, keyData.fingerprint);
}

// â”€â”€ Crypto helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function decryptKeystore(ks, passphrase) {
  const salt       = base64urlDecode(ks.salt);
  const nonce      = base64urlDecode(ks.nonce);
  const ciphertext = base64urlDecode(ks.ciphertext);

  // Argon2id â€” same params as CLI (time=3, mem=64MiB, parallelism=4, hashLen=32)
  const argon = await argon2.hash({
    pass: passphrase, salt,
    type: argon2.ArgonType.Argon2id,
    time: 3, mem: 65536, parallelism: 4, hashLen: 32,
  });

  // AES-256-GCM decrypt
  const aesKey = await crypto.subtle.importKey('raw', argon.hash, {name:'AES-GCM'}, false, ['decrypt']);
  const seed   = await crypto.subtle.decrypt({name:'AES-GCM', iv: nonce}, aesKey, ciphertext);

  // Import Ed25519 private key via PKCS8 wrapper (seed at bytes 16-47)
  const pkcs8 = new Uint8Array([
    0x30,0x2e,0x02,0x01,0x00,0x30,0x05,0x06,0x03,0x2b,0x65,0x70,0x04,0x22,0x04,0x20,
    ...new Uint8Array(seed)
  ]);
  const privateKey = await crypto.subtle.importKey('pkcs8', pkcs8, {name:'Ed25519'}, false, ['sign']);

  return { privateKey, pubkeyBytes: base64urlDecode(ks.pubkey), fingerprint: ks.fingerprint };
}

async function signAttestation(privateKey, artifactSHA256, statement, timestamp) {
  const payload = new TextEncoder().encode(`${artifactSHA256}|${statement}|${timestamp}`);
  return new Uint8Array(await crypto.subtle.sign({name:'Ed25519'}, privateKey, payload));
}

async function generateKeyInBrowser(displayName, passphrase) {
  // 1. Generate Ed25519 keypair
  const kp = await crypto.subtle.generateKey({name:'Ed25519'}, true, ['sign','verify']);

  // 2. Export public key (32 bytes raw)
  const pubkeyBytes = new Uint8Array(await crypto.subtle.exportKey('raw', kp.publicKey));

  // 3. Extract seed from PKCS8 (bytes 16-47)
  const pkcs8 = new Uint8Array(await crypto.subtle.exportKey('pkcs8', kp.privateKey));
  const seed  = pkcs8.slice(16, 48);

  // 4. Fingerprint = hex(SHA-256(pubkey))
  const fingerprint = hexEncode(await crypto.subtle.digest('SHA-256', pubkeyBytes));

  // 5. Encrypt seed: Argon2id â†’ AES-256-GCM
  const salt  = crypto.getRandomValues(new Uint8Array(16));
  const nonce = crypto.getRandomValues(new Uint8Array(12));
  const argon = await argon2.hash({
    pass: passphrase, salt,
    type: argon2.ArgonType.Argon2id,
    time: 3, mem: 65536, parallelism: 4, hashLen: 32,
  });
  const aesKey     = await crypto.subtle.importKey('raw', argon.hash, {name:'AES-GCM'}, false, ['encrypt']);
  const ciphertext = new Uint8Array(await crypto.subtle.encrypt({name:'AES-GCM', iv: nonce}, aesKey, seed));

  const keystore = {
    version: '1', algorithm: 'argon2id+aes256gcm',
    salt:        base64urlEncode(salt),
    nonce:       base64urlEncode(nonce),
    ciphertext:  base64urlEncode(ciphertext),
    pubkey:      base64urlEncode(pubkeyBytes),
    fingerprint,
    display_name: displayName,
  };

  return { keystore, fingerprint };
}

// â”€â”€ GitHub API helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function fetchProvenanceFromIssue(issueURL, token) {
  const parsed = parseIssueURL(issueURL);
  if (!parsed) throw new Error('Invalid GitHub issue URL');

  const res = await fetch(
    `https://api.github.com/repos/${parsed.owner}/${parsed.repo}/issues/${parsed.number}`,
    { headers: { Authorization: `token ${token}`, Accept: 'application/vnd.github.v3+json' } }
  );
  if (res.status === 401) throw new Error('Invalid GitHub token (401 Unauthorized)');
  if (res.status === 404) throw new Error('Issue not found â€” check the URL and your token');
  if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);

  const data  = await res.json();
  const match = data.body && data.body.match(/```json\s*\n([\s\S]*?)\n```/);
  if (!match) throw new Error('No provenance.json found in the issue body');

  let provenance;
  try { provenance = JSON.parse(match[1]); }
  catch(e) { throw new Error('Failed to parse provenance.json from issue: ' + e.message); }
  if (!provenance.artifact || !provenance.identity) throw new Error('The JSON in the issue is not a valid provenance.json');

  return { provenance, owner: parsed.owner, repo: parsed.repo, number: parsed.number };
}

async function postAttestedComment(owner, repo, number, token, updatedProvenance, attesterFp) {
  const provJSON = JSON.stringify(updatedProvenance, null, 2);
  const body =
    `## âœ… Attestation by \`${attesterFp.slice(0,16)}â€¦\`\n\n` +
    `I have reviewed and attested this binary.\n\n` +
    `<details>\n<summary>ğŸ“„ Updated provenance.json â€” send this back to the developer</summary>\n\n` +
    '```json\n' + provJSON + '\n```\n\n</details>';

  const res = await fetch(
    `https://api.github.com/repos/${owner}/${repo}/issues/${number}/comments`,
    {
      method: 'POST',
      headers: { Authorization: `token ${token}`, Accept: 'application/vnd.github.v3+json', 'Content-Type': 'application/json' },
      body: JSON.stringify({ body })
    }
  );
  if (!res.ok) throw new Error(`Failed to post comment: ${res.status}`);
  return (await res.json()).html_url;
}

// â”€â”€ Result display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function showAttestSuccess(owner, repo, number, commentURL, fingerprint) {
  attestResult.classList.remove('hidden');
  attestResult.innerHTML = `
    <div class="attest-success">
      <div class="attest-success-icon">âœ“</div>
      <div>
        <div class="attest-success-title">Attestation published!</div>
        <div class="attest-success-detail">
          Your signature was computed locally and posted as a comment on issue #${number} in ${owner}/${repo}.
          <br>The developer can now copy the updated provenance.json from your comment.
        </div>
        <a href="${commentURL}" target="_blank" class="attest-link">View comment on GitHub â†’</a>
      </div>
    </div>`;
}

function showAttestError(message) {
  attestResult.classList.remove('hidden');
  attestResult.innerHTML = `
    <div class="check-row" style="border:none;padding:0">
      <div class="check-icon fail">âœ—</div>
      <div class="check-content">
        <div class="check-title" style="color:var(--red)">Attestation failed</div>
        <div class="check-detail">${message}</div>
      </div>
    </div>`;
}

// â”€â”€ REQUESTS TAB â€” Submit a request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const submitReqToggle   = document.getElementById('submitReqToggle');
const submitReqBody     = document.getElementById('submitReqBody');
const submitReqArrow    = document.getElementById('submitReqArrow');
const reqProvDrop       = document.getElementById('reqProvDrop');
const reqProvInput      = document.getElementById('reqProvInput');
const reqProvInfo       = document.getElementById('reqProvInfo');
const reqProvSummary    = document.getElementById('reqProvSummary');
const reqProvDetail     = document.getElementById('reqProvDetail');
const reqSubmitRegistry = document.getElementById('reqSubmitRegistry');
const reqSubmitToken    = document.getElementById('reqSubmitToken');
const reqSubmitMessage  = document.getElementById('reqSubmitMessage');
const btnSubmitReq      = document.getElementById('btnSubmitReq');
const submitReqSpinner  = document.getElementById('submitReqSpinner');
const submitReqBtnText  = document.getElementById('submitReqBtnText');
const submitReqResult   = document.getElementById('submitReqResult');

let submitProvenance = null;

// Toggle expand/collapse
submitReqToggle.addEventListener('click', () => {
  const open = !submitReqBody.classList.contains('hidden');
  submitReqBody.classList.toggle('hidden', open);
  submitReqArrow.textContent = open ? 'â–¶' : 'â–¼';
});

// Drag & drop provenance.json onto submit zone
reqProvDrop.addEventListener('dragover', e => { e.preventDefault(); reqProvDrop.classList.add('drag-over'); });
reqProvDrop.addEventListener('dragleave', () => reqProvDrop.classList.remove('drag-over'));
reqProvDrop.addEventListener('drop', e => {
  e.preventDefault(); reqProvDrop.classList.remove('drag-over');
  const f = e.dataTransfer.files[0];
  if (f) loadSubmitProv(f);
});
reqProvInput.addEventListener('change', () => { if (reqProvInput.files[0]) loadSubmitProv(reqProvInput.files[0]); });

function loadSubmitProv(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const p = JSON.parse(e.target.result);
      if (!p.artifact || !p.identity) throw new Error('Not a valid provenance.json');
      submitProvenance = p;
      reqProvSummary.textContent = `${p.artifact.name} v${p.artifact.version} â€” by ${p.identity.display_name}`;
      reqProvDetail.textContent  = `SHA-256: ${p.artifact.sha256.slice(0,32)}â€¦  Â·  Fingerprint: ${p.identity.pubkey_fingerprint.slice(0,16)}â€¦`;
      reqProvInfo.classList.remove('hidden');
      reqProvDrop.style.display = 'none';
      checkSubmitReady();
    } catch(err) {
      alert('Invalid provenance.json: ' + err.message);
    }
  };
  reader.readAsText(file);
}

function checkSubmitReady() {
  btnSubmitReq.disabled = !(submitProvenance && reqSubmitToken.value.trim() && reqSubmitRegistry.value.trim());
}
reqSubmitToken.addEventListener('input', checkSubmitReady);
reqSubmitRegistry.addEventListener('input', checkSubmitReady);

btnSubmitReq.addEventListener('click', async () => {
  const token    = reqSubmitToken.value.trim();
  const slug     = reqSubmitRegistry.value.trim();
  const message  = reqSubmitMessage.value.trim();
  const p        = submitProvenance;

  submitReqSpinner.style.display = '';
  submitReqBtnText.textContent   = 'Opening issueâ€¦';
  btnSubmitReq.disabled          = true;
  submitReqResult.classList.add('hidden');

  try {
    const title = `[ATTEST REQUEST] ${p.artifact.name} v${p.artifact.version} â€” by ${p.identity.display_name}`;
    const date  = (p.signature && p.signature.timestamp || '').slice(0, 10);
    const fp    = p.identity.pubkey_fingerprint;
    const msgSection = message ? `\n> **Note from developer:** ${message}\n` : '';

    const body =
`## Attestation Request
${msgSection}
| | |
|---|---|
| **App** | ${p.artifact.name} v${p.artifact.version} |
| **Developer** | ${p.identity.display_name} |
| **Fingerprint** | \`${fp}\` |
| **SHA-256** | \`${p.artifact.sha256}\` |
| **Signed on** | ${date} |

---

### How to attest

1. Go to [open-trust-dashboard](https://lastexitfromnowhere.github.io/open-trust-dashboard/) â†’ **REQUESTS** tab
2. Click **Attest â†’** next to this request
3. Drop your \`key.json\` (or generate one in-browser)
4. Sign with your passphrase â€” the updated \`provenance.json\` is posted here automatically

> This binary needs **${(p.trust_chain && p.trust_chain.threshold) || 2} attestation(s)** to reach TRUSTED status.
> You only need the \`provenance.json\` â€” **never** share your private key.

---

<details>
<summary>ğŸ“„ provenance.json (click to expand)</summary>

\`\`\`json
${JSON.stringify(p, null, 2)}
\`\`\`

</details>`;

    const res = await fetch(`https://api.github.com/repos/${slug}/issues`, {
      method: 'POST',
      headers: {
        Authorization: `token ${token}`,
        Accept: 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title, body })
    });

    if (res.status === 401) throw new Error('GitHub token invalid or expired (401)');
    if (res.status === 403) throw new Error('Token lacks issues:write / repo scope (403)');
    if (res.status === 404) throw new Error(`Repo "${slug}" not found or is private (404)`);
    if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);

    const issue = await res.json();
    submitReqResult.classList.remove('hidden');
    submitReqResult.innerHTML = `
      <div class="attest-success">
        <div class="attest-success-icon">âœ“</div>
        <div>
          <div class="attest-success-title">Issue #${issue.number} created!</div>
          <div class="attest-success-detail">Your request is now visible in the REQUESTS list. Share this link to get attestations faster.</div>
          <a href="${issue.html_url}" target="_blank" class="attest-link">View issue on GitHub â†’</a>
        </div>
      </div>`;
    // Refresh the list below
    requestsLoaded = false;
    fetchRequests();

  } catch(err) {
    submitReqResult.classList.remove('hidden');
    submitReqResult.innerHTML = `<div style="color:var(--red);font-size:12px;">âœ— ${escHtml(err.message)}</div>`;
  } finally {
    submitReqSpinner.style.display = 'none';
    submitReqBtnText.textContent   = 'â–¶ \u00a0OPEN ISSUE';
    btnSubmitReq.disabled          = false;
  }
});

// â”€â”€ SIGN wizard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Accordion steps
document.querySelectorAll('.sign-step-header').forEach(header => {
  header.addEventListener('click', () => {
    const step = document.getElementById(header.dataset.step);
    const isOpen = step.classList.contains('open');
    // Close all, open clicked
    document.querySelectorAll('.sign-step').forEach(s => s.classList.remove('open'));
    if (!isOpen) step.classList.add('open');
  });
});

// Copy buttons
document.querySelectorAll('.btn-copy').forEach(btn => {
  btn.addEventListener('click', e => {
    e.stopPropagation();
    const block = document.getElementById(btn.dataset.cmd);
    const text  = block.innerText.replace(/^Copy$/m, '').trim();
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = 'âœ“ Copied';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 1800);
    });
  });
});

// Live command update helpers
function signVal(id, val) { const el = document.getElementById(id); if (el) el.textContent = val || el.dataset.placeholder || ''; }
function q(v) { return v.includes(' ') ? `"${v}"` : v; }

// Step 1 â€” directory
document.getElementById('s1Dir').addEventListener('input', function() {
  const d = this.value.trim() || '~/open-trust-cli';
  signVal('c1dir',  d);
  signVal('c1dir2', d);
});

// Step 3 â€” sign fields
['s3Name','s3Ver','s3File','s3Key','s3Thresh'].forEach(id => {
  document.getElementById(id).addEventListener('input', updateCmd3);
  document.getElementById(id).addEventListener('change', updateCmd3);
});
function updateCmd3() {
  const name   = document.getElementById('s3Name').value.trim()   || 'MyApp';
  const ver    = document.getElementById('s3Ver').value.trim()    || '1.0.0';
  const file   = document.getElementById('s3File').value.trim()   || './myapp.exe';
  const key    = document.getElementById('s3Key').value.trim()    || './my-name.key.json';
  const thresh = document.getElementById('s3Thresh').value;
  signVal('c3name',   q(name));
  signVal('c3ver',    q(ver));
  signVal('c3file',   file);
  signVal('c3key',    key);
  signVal('c3thresh', thresh);
  // Sync threshold to step 5 summary
  signVal('s5ThreshDisplay', thresh);
}

// Step 4 â€” token + registry
document.getElementById('s4Token').addEventListener('input', function() {
  const t = this.value.trim() || 'ghp_xxxxxxxxxxxx';
  signVal('c4tokWin',  `"${t}"`);
  signVal('c4tokUnix', `"${t}"`);
  // Sync to shared token
  syncToken(this.value.trim());
});
document.getElementById('s4Registry').addEventListener('input', function() {
  const r = this.value.trim() || 'https://github.com/Lastexitfromnowhere/open-trust-registry.git';
  signVal('c4reg',     r);
  signVal('c4regUnix', r);
});

// Pre-fill token from localStorage into step 4 when tab opens
tabSign.addEventListener('click', () => {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved && !document.getElementById('s4Token').value) {
    document.getElementById('s4Token').value = saved;
    signVal('c4tokWin',  `"${saved}"`);
    signVal('c4tokUnix', `"${saved}"`);
  }
});

// â”€â”€ GitHub token â€” shared localStorage across all tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const STORAGE_KEY = 'ot_github_token';

const attestTokenToggle   = document.getElementById('attestTokenToggle');
const attestTokenRememberRow = document.getElementById('attestTokenRememberRow');
const reqTokenToggle      = document.getElementById('reqTokenToggle');
const reqTokenRememberRow = document.getElementById('reqTokenRememberRow');

// Load saved token on startup
(function loadSavedToken() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (!saved) return;
  attestToken.value       = saved;
  reqSubmitToken.value    = saved;
  attestTokenToggle.classList.add('on');
  reqTokenToggle.classList.add('on');
  checkSubmitReady();
})();

// Sync both token fields together
function syncToken(value) {
  attestToken.value    = value;
  reqSubmitToken.value = value;
  checkSubmitReady();
  // If "remember" is on in either toggle, persist
  if (attestTokenToggle.classList.contains('on') || reqTokenToggle.classList.contains('on')) {
    if (value) localStorage.setItem(STORAGE_KEY, value);
    else       localStorage.removeItem(STORAGE_KEY);
  }
}

attestToken.addEventListener('input', () => syncToken(attestToken.value));
reqSubmitToken.addEventListener('input', () => syncToken(reqSubmitToken.value));

// Remember toggles
attestTokenRememberRow.addEventListener('click', () => {
  const on = attestTokenToggle.classList.toggle('on');
  reqTokenToggle.classList.toggle('on', on);
  if (on && attestToken.value) localStorage.setItem(STORAGE_KEY, attestToken.value);
  else localStorage.removeItem(STORAGE_KEY);
});
reqTokenRememberRow.addEventListener('click', () => {
  const on = reqTokenToggle.classList.toggle('on');
  attestTokenToggle.classList.toggle('on', on);
  if (on && reqSubmitToken.value) localStorage.setItem(STORAGE_KEY, reqSubmitToken.value);
  else localStorage.removeItem(STORAGE_KEY);
});

// â”€â”€ REQUESTS TAB â€” Browse list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

btnRefreshRequests.addEventListener('click', () => {
  requestsLoaded = true;
  fetchRequests();
});

async function fetchRequests() {
  const slug = reqRegistryInput.value.trim();
  if (!slug) return;

  // UI: loading state
  reqSpinner.style.display = '';
  reqBtnText.textContent   = 'Loadingâ€¦';
  btnRefreshRequests.disabled = true;
  reqList.innerHTML = '';
  reqEmpty.classList.add('hidden');
  reqError.classList.add('hidden');

  try {
    const res = await fetch(
      `https://api.github.com/repos/${slug}/issues?state=open&per_page=100`,
      { headers: { Accept: 'application/vnd.github.v3+json' } }
    );
    if (!res.ok) {
      if (res.status === 404) throw new Error(`Repository "${slug}" not found or is private.`);
      throw new Error(`GitHub API error: ${res.status}`);
    }

    const issues = await res.json();
    // Filter: only [ATTEST REQUEST] issues
    const reqs = issues.filter(i => i.title.startsWith('[ATTEST REQUEST]'));

    if (reqs.length === 0) {
      reqEmpty.classList.remove('hidden');
    } else {
      reqs.forEach(issue => reqList.appendChild(buildReqCard(issue)));
    }
  } catch (err) {
    reqError.textContent = err.message;
    reqError.classList.remove('hidden');
  } finally {
    reqSpinner.style.display = 'none';
    reqBtnText.textContent   = 'â†» \u00a0REFRESH';
    btnRefreshRequests.disabled = false;
  }
}

// Parse title: "[ATTEST REQUEST] AppName v1.0.0 â€” by DisplayName"
function parseReqTitle(title) {
  const m = title.match(/^\[ATTEST REQUEST\]\s+(.+?)\s+v([^\sâ€”]+)\s+[â€”-]+\s+by\s+(.+)$/i);
  if (m) return { name: m[1], version: m[2], developer: m[3] };
  // Fallback: strip prefix
  const stripped = title.replace(/^\[ATTEST REQUEST\]\s*/i, '');
  return { name: stripped, version: '', developer: '' };
}

function timeAgo(isoDate) {
  const diff = Date.now() - new Date(isoDate).getTime();
  const d = Math.floor(diff / 86400000);
  if (d === 0) return 'today';
  if (d === 1) return 'yesterday';
  if (d < 30)  return `${d} days ago`;
  const m = Math.floor(d / 30);
  return `${m} month${m>1?'s':''} ago`;
}

function buildReqCard(issue) {
  const { name, version, developer } = parseReqTitle(issue.title);
  const comments  = issue.comments;
  const date      = timeAgo(issue.created_at);
  const issueURL  = issue.html_url;

  // Badge: if comments > 0, show count, else show "Needs attestations"
  const badgeHTML = comments > 0
    ? `<span class="req-pill done">âœ“ ${comments} attestation${comments>1?'s':''}</span>`
    : `<span class="req-pill need">â³ No attestations yet</span>`;

  const card = document.createElement('div');
  card.className = 'req-card';
  card.innerHTML = `
    <div class="req-icon">ğŸ“¦</div>
    <div class="req-body">
      <div class="req-name">
        ${escHtml(name)}${version ? `<span class="req-version">v${escHtml(version)}</span>` : ''}
      </div>
      <div class="req-meta">
        ${developer ? `<span>ğŸ‘¤ ${escHtml(developer)}</span>` : ''}
        <span>ğŸ• ${date}</span>
        <span>ğŸ”— issue #${issue.number}</span>
      </div>
      <div class="req-actions">
        ${badgeHTML}
        <button class="btn-attest-req" data-url="${escHtml(issueURL)}">Attest â†’</button>
        <a href="${escHtml(issueURL)}" target="_blank" class="req-github-link">View on GitHub â†—</a>
      </div>
    </div>`;

  card.querySelector('.btn-attest-req').addEventListener('click', () => {
    // Pre-fill the ATTEST tab issue URL and switch to it
    document.getElementById('issueInput').value = issueURL;
    document.getElementById('issueInput').dispatchEvent(new Event('input'));
    switchTab('attest');
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  return card;
}

function escHtml(str) {
  return String(str)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â”€â”€ EXPLORE â€” Trust Graph â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let exploreGraph = null;

const exploreSlug    = document.getElementById('exploreSlug');
const btnLoadExplore = document.getElementById('btnLoadExplore');
const exploreStatus  = document.getElementById('exploreStatus');
const exploreError   = document.getElementById('exploreError');
const exploreArtifacts = document.getElementById('exploreArtifacts');
const exploreCommunity = document.getElementById('exploreCommunity');
const artifactList   = document.getElementById('artifactList');
const communityGrid  = document.getElementById('communityGrid');

btnLoadExplore.addEventListener('click', loadExplore);

async function loadExplore() {
  const slug  = exploreSlug.value.trim();
  if (!slug) return;
  const token = localStorage.getItem(STORAGE_KEY) || '';

  btnLoadExplore.disabled = true;
  btnLoadExplore.textContent = 'Loadingâ€¦';
  exploreStatus.classList.remove('hidden');
  exploreError.classList.add('hidden');
  exploreArtifacts.classList.add('hidden');
  exploreCommunity.classList.add('hidden');
  artifactList.innerHTML = '';
  communityGrid.innerHTML = '';

  try {
    exploreStatus.textContent = 'Fetching registry indexâ€¦';
    const headers = { Accept: 'application/vnd.github.v3+json' };
    if (token) headers.Authorization = `token ${token}`;

    const repoRes = await fetch(`https://api.github.com/repos/${slug}`, { headers });
    if (!repoRes.ok) throw new Error(`Repo not found or private: ${slug}`);
    const repoData = await repoRes.json();
    const branch = repoData.default_branch || 'main';

    const treeRes = await fetch(`https://api.github.com/repos/${slug}/git/trees/HEAD?recursive=1`, { headers });
    if (!treeRes.ok) throw new Error(`Failed to fetch registry tree: ${treeRes.status}`);
    const treeData = await treeRes.json();
    if (treeData.truncated) {
      exploreStatus.textContent = 'âš ï¸ Registry is very large â€” showing partial results. Use a token for best results.';
    }

    const identityPaths = treeData.tree.filter(f => /^keys/[^/]+/identity.json$/.test(f.path)).map(f => f.path);
    const sigPaths      = treeData.tree.filter(f => /^keys/[^/]+/signatures/.+.json$/.test(f.path)).map(f => f.path);

    if (sigPaths.length === 0) {
      exploreStatus.textContent = 'No signed artifacts found in this registry yet.';
      btnLoadExplore.disabled = false;
      btnLoadExplore.textContent = 'â†» RELOAD';
      return;
    }

    const rawBase = `https://raw.githubusercontent.com/${slug}/${branch}`;
    exploreStatus.textContent = `Fetching ${identityPaths.length} identities + ${sigPaths.length} artifactsâ€¦`;

    async function fetchJSON(p) {
      const res = await fetch(`${rawBase}/${p}`);
      if (!res.ok) return null;
      return res.json().catch(() => null);
    }

    async function batchFetch(paths, batchSize = 20) {
      const results = [];
      for (let i = 0; i < paths.length; i += batchSize) {
        const batch = await Promise.all(paths.slice(i, i + batchSize).map(fetchJSON));
        results.push(...batch);
        if (i + batchSize < paths.length) {
          exploreStatus.textContent = `Fetchingâ€¦ ${Math.min(i + batchSize, paths.length)}/${paths.length}`;
        }
      }
      return results;
    }

    const [rawIdentities, rawArtifacts] = await Promise.all([
      batchFetch(identityPaths),
      batchFetch(sigPaths)
    ]);

    const graph = { identities: {}, artifacts: [] };

    for (const id of rawIdentities.filter(Boolean)) {
      graph.identities[id.pubkey_fingerprint] = {
        ...id, artifactsSigned: [], attestationsGiven: [], devScore: 0, attesterScore: 0,
      };
    }

    for (const prov of rawArtifacts.filter(Boolean)) {
      graph.artifacts.push(prov);
      const fp   = prov.identity?.pubkey_fingerprint;
      const atts = prov.attestations ?? [];
      if (fp && !graph.identities[fp]) {
        graph.identities[fp] = {
          display_name: prov.identity.display_name || fp.slice(0,12)+'â€¦',
          pubkey_fingerprint: fp, pubkey_ed25519: prov.identity.pubkey_ed25519,
          social_proofs: prov.identity.social_proofs || [],
          artifactsSigned: [], attestationsGiven: [], devScore: 0, attesterScore: 0,
        };
      }
      if (fp && graph.identities[fp]) {
        graph.identities[fp].artifactsSigned.push(prov);
        graph.identities[fp].devScore += atts.length;
      }
      for (const att of atts) {
        const afp = att.attester_fingerprint;
        if (!afp) continue;
        if (!graph.identities[afp]) {
          graph.identities[afp] = {
            display_name: afp.slice(0,12)+'â€¦', pubkey_fingerprint: afp,
            artifactsSigned: [], attestationsGiven: [], devScore: 0, attesterScore: 0,
          };
        }
        graph.identities[afp].attestationsGiven.push({ artifact: prov, attestation: att });
        graph.identities[afp].attesterScore += 1;
      }
    }

    exploreGraph = graph;
    exploreStatus.classList.add('hidden');
    renderExplore(graph);

  } catch(err) {
    exploreStatus.classList.add('hidden');
    exploreError.textContent = 'âœ— ' + err.message;
    exploreError.classList.remove('hidden');
  } finally {
    btnLoadExplore.disabled = false;
    btnLoadExplore.textContent = 'â†» RELOAD';
  }
}

function trustLevel(atts, threshold) {
  if (atts >= threshold) return { label: 'TRUSTED',    cls: 'trusted' };
  if (atts > 0)          return { label: 'PENDING',    cls: 'pending' };
  return                        { label: 'UNVERIFIED', cls: 'unverif' };
}

function renderExplore(graph) {
  artifactList.innerHTML = '';
  const sorted = [...graph.artifacts].sort((a,b) =>
    (b.attestations?.length||0) - (a.attestations?.length||0));

  for (const prov of sorted) {
    const atts      = prov.attestations ?? [];
    const threshold = prov.trust_chain?.threshold ?? 2;
    const lvl       = trustLevel(atts.length, threshold);
    const fp        = prov.identity?.pubkey_fingerprint ?? '';
    const devName   = prov.identity?.display_name ?? 'Unknown';
    const progress  = Math.min(100, Math.round((atts.length / threshold) * 100));
    const date      = (prov.signature?.timestamp || '').slice(0,10);
    const attestorChips = atts.map(a =>
      `<button class="fp-chip" onclick="openFpModal('${a.attester_fingerprint}',event)">${a.attester_fingerprint.slice(0,12)}â€¦</button>`
    ).join(' ');
    const card = document.createElement('div');
    card.className = 'artifact-card';
    card.innerHTML = `
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;">
        <div style="flex:1;min-width:0;">
          <div style="font-family:var(--title);font-size:13px;font-weight:700;color:#fff;letter-spacing:.06em;margin-bottom:3px;">
            ${escHtml(prov.artifact.name)}
            <span style="color:var(--accent);font-weight:400;font-family:var(--mono);font-size:11px;margin-left:8px;">v${escHtml(prov.artifact.version||'â€”')}</span>
          </div>
          <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;">
            by <button class="fp-chip" onclick="openFpModal('${fp}',event)" style="margin-left:2px;">${escHtml(devName)}</button>
            Â· ${date}
          </div>
          <div style="font-size:10px;color:var(--text-muted);font-family:var(--mono);margin-bottom:10px;">
            sha256: ${prov.artifact.sha256.slice(0,32)}â€¦
          </div>
          <div class="att-progress-wrap">
            <div class="att-progress" style="width:${progress}%"></div>
          </div>
          <div style="font-size:10px;color:var(--text-muted);margin-top:4px;margin-bottom:${atts.length?'8px':'0'};">
            ${atts.length} / ${threshold} attestation${threshold>1?'s':''}
          </div>
          ${atts.length ? `<div style="display:flex;flex-wrap:wrap;gap:5px;margin-top:4px;">${attestorChips}</div>` : ''}
        </div>
        <span class="trust-lvl ${lvl.cls}">${lvl.label}</span>
      </div>`;
    artifactList.appendChild(card);
  }
  exploreArtifacts.classList.remove('hidden');

  communityGrid.innerHTML = '';
  const members = Object.values(graph.identities)
    .sort((a,b) => (b.devScore + b.attesterScore) - (a.devScore + a.attesterScore));

  members.forEach((id, idx) => {
    const totalScore = id.devScore + id.attesterScore;
    const stars = totalScore >= 10 ? 'â˜…â˜…â˜…' : totalScore >= 4 ? 'â˜…â˜…â˜†' : totalScore >= 1 ? 'â˜…â˜†â˜†' : 'â˜†â˜†â˜†';
    const fp = id.pubkey_fingerprint;
    const card = document.createElement('div');
    card.className = 'community-card';
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="font-family:var(--title);font-size:18px;color:rgba(74,222,128,0.25);font-weight:900;min-width:28px;">#${idx+1}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-family:var(--title);font-size:11px;font-weight:700;color:#fff;letter-spacing:.06em;margin-bottom:2px;">${escHtml(id.display_name||fp.slice(0,16)+'â€¦')}</div>
          <div style="font-family:var(--mono);font-size:10px;color:var(--text-muted);">
            <button class="fp-chip" onclick="openFpModal('${fp}',event)">${fp.slice(0,16)}â€¦</button>
          </div>
        </div>
        <div style="text-align:right;flex-shrink:0;">
          <div style="color:var(--accent);font-size:13px;letter-spacing:.05em;">${stars}</div>
          <div style="font-size:10px;color:var(--text-muted);margin-top:2px;">score ${totalScore}</div>
        </div>
      </div>
      <div style="display:flex;gap:16px;margin-top:10px;font-size:11px;color:var(--text-muted);">
        <span>ğŸ“¦ ${id.artifactsSigned.length} signed</span>
        <span>âœ“ ${id.attestationsGiven.length} attested</span>
        ${id.first_seen ? `<span>ğŸ“… since ${id.first_seen.slice(0,10)}</span>` : ''}
      </div>`;
    communityGrid.appendChild(card);
  });
  exploreCommunity.classList.remove('hidden');
}

// â”€â”€ Fingerprint modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const fpModal        = document.getElementById('fpModal');
const fpModalClose   = document.getElementById('fpModalClose');
const fpModalContent = document.getElementById('fpModalContent');

fpModalClose.addEventListener('click', () => fpModal.classList.add('hidden'));
fpModal.addEventListener('click', e => { if (e.target === fpModal) fpModal.classList.add('hidden'); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') fpModal.classList.add('hidden'); });

async function openFpModal(fp, event) {
  if (event) event.stopPropagation();
  fpModalContent.innerHTML = `<div style="text-align:center;padding:20px;color:var(--text-muted);">Loading profileâ€¦</div>`;
  fpModal.classList.remove('hidden');

  if (exploreGraph && exploreGraph.identities[fp]) {
    renderFpModal(fp, exploreGraph.identities[fp], exploreGraph);
    return;
  }

  const slug  = (document.getElementById('exploreSlug') || document.getElementById('reqRegistryInput')).value.trim()
              || 'Lastexitfromnowhere/open-trust-registry';
  const token = localStorage.getItem(STORAGE_KEY) || '';
  try {
    const headers = { Accept: 'application/vnd.github.v3+json' };
    if (token) headers.Authorization = `token ${token}`;
    const repoRes = await fetch(`https://api.github.com/repos/${slug}`, { headers });
    const branch  = repoRes.ok ? (await repoRes.json()).default_branch : 'main';
    const rawBase = `https://raw.githubusercontent.com/${slug}/${branch}`;

    const idRes   = await fetch(`${rawBase}/keys/${fp}/identity.json`);
    const id      = idRes.ok ? await idRes.json() : null;
    const identity = id || { display_name: fp.slice(0,16)+'â€¦', pubkey_fingerprint: fp, artifactsSigned: [], attestationsGiven: [] };
    identity.artifactsSigned   = identity.artifactsSigned   || [];
    identity.attestationsGiven = identity.attestationsGiven || [];
    renderFpModal(fp, identity, null);
  } catch(err) {
    fpModalContent.innerHTML = `<div style="color:var(--red);font-size:12px;">Failed to load profile: ${escHtml(err.message)}</div>`;
  }
}

function renderFpModal(fp, id, graph) {
  const totalScore = (id.devScore||0) + (id.attesterScore||0);
  const stars = totalScore >= 10 ? 'â˜…â˜…â˜…' : totalScore >= 4 ? 'â˜…â˜…â˜†' : totalScore >= 1 ? 'â˜…â˜†â˜†' : 'â˜†â˜†â˜†';

  const signedHTML = (id.artifactsSigned||[]).map(p =>
    `<div style="font-size:11px;padding:5px 0;border-bottom:1px solid var(--border);color:var(--text-dim);">
      ğŸ“¦ <strong>${escHtml(p.artifact?.name||'?')}</strong> v${escHtml(p.artifact?.version||'?')}
      <span style="color:var(--text-muted);margin-left:8px;">${(p.attestations?.length||0)} attestation(s)</span>
    </div>`).join('') || '<div style="font-size:11px;color:var(--text-muted);">No published artifacts.</div>';

  const givenHTML = (id.attestationsGiven||[]).map(({artifact, attestation}) =>
    `<div style="font-size:11px;padding:5px 0;border-bottom:1px solid var(--border);color:var(--text-dim);">
      âœ“ <strong>${escHtml(artifact?.artifact?.name||'?')}</strong>
      <span style="color:var(--text-muted);margin-left:6px;">&quot;${escHtml(attestation?.statement||'')}&quot;</span>
    </div>`).join('') || '<div style="font-size:11px;color:var(--text-muted);">No attestations given yet.</div>';

  const socialHTML = (id.social_proofs||[]).map(sp =>
    `<a href="${escHtml(sp.proof_url)}" target="_blank" style="font-size:11px;color:var(--accent);text-decoration:none;display:block;margin-bottom:3px;">
      ğŸŒ ${escHtml(sp.platform)} Â· ${escHtml(sp.handle)}</a>`).join('');

  fpModalContent.innerHTML = `
    <div style="font-family:var(--title);font-size:14px;font-weight:900;color:#fff;letter-spacing:.10em;margin-bottom:4px;">
      ${escHtml(id.display_name || fp.slice(0,16)+'â€¦')}
    </div>
    <div style="font-size:10px;color:var(--text-muted);font-family:var(--mono);word-break:break-all;margin-bottom:16px;">${fp}</div>
    <div style="display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="text-align:center;">
        <div style="font-size:20px;color:var(--accent);">${stars}</div>
        <div style="font-size:10px;color:var(--text-muted);">Trust Score ${totalScore}</div>
      </div>
      <div style="font-size:11px;color:var(--text-muted);display:flex;flex-direction:column;gap:4px;justify-content:center;">
        <span>ğŸ“¦ ${(id.artifactsSigned||[]).length} artifacts signed</span>
        <span>âœ“ ${(id.attestationsGiven||[]).length} attestations given</span>
        ${id.first_seen ? `<span>ğŸ“… Member since ${id.first_seen.slice(0,10)}</span>` : ''}
      </div>
    </div>
    ${socialHTML ? `<div style="margin-bottom:16px;">${socialHTML}</div>` : ''}
    <div style="font-size:10px;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted);margin-bottom:8px;">Artifacts Signed</div>
    <div style="margin-bottom:16px;">${signedHTML}</div>
    ${graph ? `<div style="font-size:10px;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted);margin-bottom:8px;">Attestations Given</div>
    <div>${givenHTML}</div>` : `<div style="font-size:11px;color:var(--text-muted);margin-top:8px;">Load the <strong>EXPLORE</strong> tab for full attestation history.</div>`}
  `;
}

</script>
</body>
</html>
